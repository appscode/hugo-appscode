<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <meta name="theme-color" content="#2D9AED" />
    <title>KubeDB Home</title>
    
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
    
    <link rel="stylesheet" href="/assets/css/font-awesome.min.css" />
    
    <link rel="stylesheet" href="/assets/css/bulma-carousel.min.css" />
    
    <link rel="stylesheet" href="/assets/css/bulma.min.css" />
    
    <link rel="stylesheet" href="/assets/css/style.css" />
    
    <link rel="stylesheet" href="/assets/css/responsive.css" />
  </head>

  <body>
    

    
    
    <header>
      
      
      <div class="header-top">
        <div class="container section">
          <nav class="navbar">
            <div class="navbar-brand">
              <a class="navbar-item" href="#">
                <img src="/assets/images/logo-color-appscode.png" alt="" />
              </a>

              <a
                role="button"
                class="navbar-burger burger"
                aria-label="menu"
                aria-expanded="false"
                data-target="acNav1"
              >
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
              </a>
            </div>

            <div id="acNav1" class="navbar-menu main-menu">
              <div class="navbar-end">
                
                <div class="navbar-start">
                  <div class="navbar-item has-dropdown ac-is-hoverable">
                    <a class="navbar-link">
                      Products
                    </a>

                    
                    <div class="ac-megamenu">
                      <div class="columns">
                        <div class="column is-8">
                          <div class="columns">
                            <div class="column is-6 br-1">
                              
                              <a
                                href="#"
                                class="single-product-item is-voyager"
                              >
                                <div class="menu-header">
                                  <div class="menu-logo">
                                    <img
                                      src="/assets/images/product-logo/appscode.png"
                                      alt=""
                                    />
                                  </div>
                                  <h5>Voyager</h5>
                                </div>
                                <div class="menu-body">
                                  <p>
                                    Secure Ingress Controller for
                                  </p>
                                </div>
                              </a>
                              
                              
                              <a href="#" class="single-product-item is-kubedb">
                                <div class="menu-header">
                                  <div class="menu-logo">
                                    <img
                                      src="/assets/images/product-logo/kubedb.png"
                                      alt=""
                                    />
                                  </div>
                                  <h5>KubeDB</h5>
                                </div>
                                <div class="menu-body">
                                  <p>
                                    A Kubernetes Cluster Operator
                                  </p>
                                </div>
                              </a>
                              
                              
                              <a href="#" class="single-product-item is-stash">
                                <div class="menu-header">
                                  <div class="menu-logo">
                                    <img
                                      src="/assets/images/product-logo/appscode.png"
                                      alt=""
                                    />
                                  </div>
                                  <h5>Stash</h5>
                                </div>
                                <div class="menu-body">
                                  <p>
                                    Backup your Kubernetes Volumes
                                  </p>
                                </div>
                              </a>
                              
                              
                              <a
                                href="#"
                                class="single-product-item is-elasticsearch"
                              >
                                <div class="menu-header">
                                  <div class="menu-logo">
                                    <img
                                      src="/assets/images/product-logo/appscode.png"
                                      alt=""
                                    />
                                  </div>
                                  <h5>Elasticsearch</h5>
                                </div>
                                <div class="menu-body">
                                  <p>
                                    Secure Ingress Controller for
                                  </p>
                                </div>
                              </a>
                              
                            </div>
                            <div class="column is-6 br-1">
                              
                              <a
                                href="#"
                                class="single-product-item is-searchlight"
                              >
                                <div class="menu-header">
                                  <div class="menu-logo">
                                    <img
                                      src="/assets/images/product-logo/appscode.png"
                                      alt=""
                                    />
                                  </div>
                                  <h5>Searchlight</h5>
                                </div>
                                <div class="menu-body">
                                  <p>
                                    Secure Ingress Controller for
                                  </p>
                                </div>
                              </a>
                              
                              
                              <a href="#" class="single-product-item is-guard">
                                <div class="menu-header">
                                  <div class="menu-logo">
                                    <img
                                      src="/assets/images/product-logo/appscode.png"
                                      alt=""
                                    />
                                  </div>
                                  <h5>Guard</h5>
                                </div>
                                <div class="menu-body">
                                  <p>
                                    Alerts for Kubernetes
                                  </p>
                                </div>
                              </a>
                              
                              
                              <a href="#" class="single-product-item is-broker">
                                <div class="menu-header">
                                  <div class="menu-logo">
                                    <img
                                      src="/assets/images/product-logo/kubedb.png"
                                      alt=""
                                    />
                                  </div>
                                  <h5>Service Broker</h5>
                                </div>
                                <div class="menu-body">
                                  <p>
                                    Secure Ingress Controller for
                                  </p>
                                </div>
                              </a>
                              
                              
                              <a
                                href="#"
                                class="single-product-item is-pharmer"
                              >
                                <div class="menu-header">
                                  <div class="menu-logo">
                                    <img
                                      src="/assets/images/product-logo/appscode.png"
                                      alt=""
                                    />
                                  </div>
                                  <h5>Pharmer</h5>
                                </div>
                                <div class="menu-body">
                                  <p>
                                    Secure Ingress Controller for
                                  </p>
                                </div>
                              </a>
                              
                            </div>
                          </div>
                        </div>
                        <div class="column is-4">
                          
                          <a
                            href="#"
                            class="single-product-item byte-builder kd-orange"
                          >
                            <div class="menu-header">
                              <p class="intro">Introducing....</p>
                              <h5>Byte.builders</h5>
                            </div>
                            <div class="menu-body">
                              <p>
                                Secure Ingress Controller for KubernetesSecure
                                Ingress ontroller
                              </p>
                            </div>
                            <p class="learn-more-btn">
                              Learn more
                              <span class="icon"
                                ><i
                                  class="fa fa-long-arrow-right"
                                  aria-hidden="true"
                                ></i
                              ></span>
                            </p>
                          </a>
                          

                          
                          <a href="#" class="single-product-item is-postgres">
                            <div class="menu-header">
                              <div class="menu-logo">
                                <img
                                  src="/assets/images/product-logo/appscode.png"
                                  alt=""
                                />
                              </div>
                              <h5>Postgres</h5>
                            </div>
                            <div class="menu-body">
                              <p>
                                Secure Ingress Controller for
                              </p>
                            </div>
                          </a>
                          
                          
                          <a href="#" class="single-product-item is-swift">
                            <div class="menu-header">
                              <div class="menu-logo">
                                <img
                                  src="/assets/images/product-logo/appscode.png"
                                  alt=""
                                />
                              </div>
                              <h5>Swift</h5>
                            </div>
                            <div class="menu-body">
                              <p>
                                Secure Ingress Controller for
                              </p>
                            </div>
                          </a>
                          
                        </div>
                      </div>
                      <div class="columns has-text-centered">
                        <div class="column">
                          <div class="menu-bottom">
                            <p>
                              Explore refreshing apps and integrations for
                              AppsCode products:
                              <a href="#"
                                >Visit the Marketplace
                                <i
                                  class="fa fa-long-arrow-right"
                                  aria-hidden="true"
                                ></i
                              ></a>
                            </p>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                  </div>

                  <a class="navbar-item">
                    Services
                  </a>
                  <a class="navbar-item">
                    Open Source
                  </a>
                  <a class="navbar-item">
                    Blog
                  </a>
                  <a class="navbar-item">
                    Contact
                  </a>
                </div>
                
                <div class="navbar-item">
                  <div class="buttons main-menu-button-top">
                    <a class="button is-small for-support">
                      <span
                        ><img
                          src="/assets/images/icon/chat.png"
                          alt=""/></span
                      >Forum
                    </a>
                    <a class="button is-small for-chat">
                      <span
                        ><img
                          src="/assets/images/icon/slack.png"
                          alt=""/></span
                      >Chat
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </nav>
        </div>
      </div>
      
      

      
      <div
        class="header-bottom-area header-area kubedb-primary-bg customize-kubedb"
        id="header"
      >
        <div class="container section">
          <nav class="navbar">
            <div class="navbar-brand">
              <a class="navbar-item" href="index.html">
                <img src="/assets/images/kubedb-white.png" alt="" />
              </a>

              <a
                role="button"
                class="navbar-burger burger"
                aria-label="menu"
                aria-expanded="false"
                data-target="acNav"
              >
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
              </a>
            </div>

            <div id="acNav" class="navbar-menu main-menu">
              <div class="navbar-end">
                
                
                  
                    
                    <div class="navbar-start">
                    
                    
                      
                        
                          <a href="/products/guard/features/" class="navbar-item">Features</a>
                        
                      
                    
                      
                        
                          <a href="/products/guard/pricing/" class="navbar-item">Commercial Support</a>
                        
                      
                    
                      
                        
                          <a href="/products/guard/0.4.0/welcome/">Documentation</a>
                        
                      
                    
                      
                        <div class="navbar-item has-dropdown ac-is-hoverable">
                          <a class="navbar-link">Community</a>
                          <div class="ac-dropdown">
                            
                              
                                <a href="https://github.com/kubedb" class="navbar-item">GitHub</a>
                              
                            
                              
                                <a href="https://twitter.com/KubeDB" class="navbar-item">Twitter</a>
                              
                            
                              
                                <a href="https://groups.google.com/forum/#!forum/kubedb" class="navbar-item">Groups</a>
                              
                            
                              
                                <a href="http://slack.kubernetes.io/" class="navbar-item">Slack</a>
                              
                            
                              
                                <a href="http://discourse.appscode.com" class="navbar-item">Forum</a>
                              
                            
                          </div>
                        </div>
                      
                    
                    </div>
                    

                    
                    <div class="navbar-item">
                      <div class="buttons main-menu-button">
                        
                        <a
                          class="github-button"
                          href="https://github.com/appscode/guard"
                          data-size="large"
                          data-show-count="true"
                          aria-label="Star appscode/guard on GitHub"
                        >Star</a>
                        
                        <script async defer src="https://buttons.github.io/buttons.js"></script>
                      </div>
                    </div>
                  
                
              </div>
            </div>
          </nav>
        </div>
      </div>
      

      




<div class="kubedb-documentation-menu">
  <div class="container section">
    
    <div class="documentation-menu">
      <div class="container section">
        <div class="columns is-centered">
          <div class="column is-half has-text-centered">
            
            <div class="responsive-menu">
              <a
                role="button"
                class="navbar-burger burger"
                aria-label="menu"
                aria-expanded="false"
                data-target="acNav3"
              >
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
              </a>
            </div>
            
            
            <nav class="documentation-navbar">
              <div id="acNav3" class="navbar-menu nav-menu main-menu">
                <div class="navbar-centered">
                  
                  <div class="navbar-start">
                    
                    
                      
                        
                          <a href="/products/guard/0.2.0/" class=" navbar-item">Welcome</a>
                        
                      
                        
                          <a href="/products/guard/0.2.0/concepts/" class=" navbar-item">Concepts</a>
                        
                      
                        
                          <a href="/products/guard/0.2.0/setup/" class=" is-active  navbar-item">Setup</a>
                        
                      
                        
                          <a href="/products/guard/0.2.0/guides/" class=" navbar-item">Guides</a>
                        
                      
                        
                          <a href="/products/guard/0.2.0/reference/" class=" navbar-item">Reference</a>
                        
                      
                    
                  </div>
                  
                </div>
              </div>
            </nav>
            
          </div>
        </div>
      </div>
    </div>
    
  </div>
</div>


    </header>
    
    

    
    









<div class="documentation-area">
  <div class="container section">
    <div class="columns">
      <div class="column is-3">
        
        <div class="kd-left-sidebar">
          <div class="kd-version">
            
              
              
              
              

              <div class="dropdown">
                <div class="dropdown-trigger">
                  <button
                    class="button is-fullwidth"
                    aria-haspopup="true"
                    aria-controls="dropdown-menu3"
                  >

                    
                      
                      
                        
                      
                    
                      
                      
                        
                      
                    
                      
                      
                        
                      
                    
                      
                      
                        
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    

                    <span class="icon is-small">
                      <i class="fa fa-angle-down" aria-hidden="true"></i>
                    </span>
                  </button>
                </div>
                <div class="dropdown-menu" id="dropdown-menu3" role="menu">
                  <div class="dropdown-content">
                    
                      
                      
                        
                          <a href="https://github.com/appscode/guard/tree/master/docs" target="_blank" class="dropdown-item">master</a>
                        
                      
                    
                      
                      
                        
                          <a href="/products/guard/0.4.0/" class="dropdown-item">0.4.0   <div class="tag">New</div> </a>
                        
                      
                    
                      
                      
                        
                          <a href="/products/guard/0.3.0/" class="dropdown-item">0.3.0  </a>
                        
                      
                    
                      
                      
                        
                          <a href="/products/guard/0.2.1/" class="dropdown-item">0.2.1  </a>
                        
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                  </div>
                </div>
              </div>

            
          </div>

          
            
            
              
            
              
            
              
                
                  

                  
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                
              
            
              
            
              
            
          

          
          <div class="kd-sidebar-menu">
            
              

              
              

                
              

                
              

                
                  

                  
                  

                    
                      




  



<div class="item">
  <input type="checkbox" id="75d595c4113e96fda0a5cf74f4f42a42-1" >
  <label for="75d595c4113e96fda0a5cf74f4f42a42-1"><a href="/products/guard/0.2.0/setup/">Setup</a></label>
</div>


                    
                    
                  

                    
                      






<div class="item">
  <input type="checkbox" id="75d595c4113e96fda0a5cf74f4f42a42-2" checked>
  <label for="75d595c4113e96fda0a5cf74f4f42a42-2"><a href="/products/guard/0.2.0/setup/install/">Install</a></label>
</div>


                    
                    
                  

                    
                      






<div class="item">
  <input type="checkbox" id="75d595c4113e96fda0a5cf74f4f42a42-3" >
  <label for="75d595c4113e96fda0a5cf74f4f42a42-3"><a href="/products/guard/0.2.0/setup/install-kops/">Install in Kops</a></label>
</div>


                    
                    
                  

                    
                      






<div class="item">
  <input type="checkbox" id="75d595c4113e96fda0a5cf74f4f42a42-4" >
  <label for="75d595c4113e96fda0a5cf74f4f42a42-4"><a href="/products/guard/0.2.0/setup/install-kubespray/">Install in Kubespray</a></label>
</div>


                    
                    
                  

                    
                      






<div class="item">
  <input type="checkbox" id="75d595c4113e96fda0a5cf74f4f42a42-5" >
  <label for="75d595c4113e96fda0a5cf74f4f42a42-5"><a href="/products/guard/0.2.0/setup/uninstall/">Uninstall</a></label>
</div>


                    
                    
                  

                    
                      






<div class="item">
  <input type="checkbox" id="75d595c4113e96fda0a5cf74f4f42a42-6" >
  <label for="75d595c4113e96fda0a5cf74f4f42a42-6"><a href="/products/guard/0.2.0/setup/troubleshooting/">Troubleshooting</a></label>
</div>


                    
                    
                  

                    
                      
                        






<div class="item">
  <input type="checkbox" id="75d595c4113e96fda0a5cf74f4f42a42-7" >
  <label for="75d595c4113e96fda0a5cf74f4f42a42-7"><a>Developer Guide</a> <span><i class="fa fa-angle-right"
              aria-hidden="true"></i></span></label>
  <div class="item">
    <ul>
      
        
          <li ><a href="/products/guard/0.2.0/setup/developer-guide/overview/">Overview</a></li>
        
      
        
          <li ><a href="/products/guard/0.2.0/setup/developer-guide/release/">Release Process</a></li>
        
      
    </ul>
  </div>
</div>


                      

                    
                    
                  
                  

                
              

                
              

                
              
              
            
          </div>
          
        </div>
        
      </div>
      <div class="column is-7">
        <div class="full-info">
          

<blockquote>
<p>New to Guard? Please start <a href="/products/guard/0.2.0/concepts">here</a>.</p>
</blockquote>

<h1 id="installation-guide">Installation Guide</h1>

<p>Guard binary works as a cli and server. In cli mode, you can use <code>guard</code> to generate various configuration to easily deploy Guard server. Guard server uses TLS client auth to secure the communication channel between Kubernetes api server and Guard server. You can run Guard server external to a Kubernetes cluster. This document shows you how to <code>self-host</code> Guard server in a Kubernetes cluster. To that end, we run Guard server using a predefined Service ClusterIP <code>10.96.10.96</code> and port <code>443</code>. This ClusterIP is chosen so that it falls in the default &ndash;service-cidr range for <a href="https://kubernetes.io/docs/admin/kubeadm/">Kubeadm</a>. If the service CIDR range for your cluster is different, please pick an appropriate ClusterIP.</p>

<p>If you want to set up guard via <a href="https://github.com/kubernetes/kops"><strong>Kops</strong></a> visit <a href="/products/guard/0.2.0/setup/install-kops">here</a> to see differences in setup.</p>

<p>If you want to set up guard via <a href="https://github.com/kubernetes-incubator/kubespray"><strong>Kubespray</strong></a> visit <a href="/products/guard/0.2.0/setup/install-kubespray">here</a>.</p>

<h2 id="install-guard-as-cli">Install Guard as CLI</h2>

<p>Download pre-built binaries from <a href="https://github.com/appscode/guard/releases">appscode/guard Github releases</a> and put the binary to some directory in your <code>PATH</code>. To install on Linux 64-bit and MacOS 64-bit you can run the following commands:</p>

<pre><code class="language-console"># Linux amd 64-bit:
wget -O guard https://github.com/appscode/guard/releases/download/0.2.0/guard-linux-amd64 \
  &amp;&amp; chmod +x guard \
  &amp;&amp; sudo mv guard /usr/local/bin/

# Mac 64-bit
wget -O guard https://github.com/appscode/guard/releases/download/0.2.0/guard-darwin-amd64 \
  &amp;&amp; chmod +x guard \
  &amp;&amp; sudo mv guard /usr/local/bin/
</code></pre>

<p>If you prefer to install Guard cli from source code, you will need to set up a GO development environment following <a href="https://golang.org/doc/code.html">these instructions</a>. Then, install <code>guard</code> CLI using <code>go get</code> from source code.</p>

<pre><code class="language-bash">go get github.com/appscode/guard
</code></pre>

<p>Please note that this will install Guard cli from master branch which might include breaking and/or undocumented changes.</p>

<h2 id="initialize-pki">Initialize PKI</h2>

<p>Guard uses TLS client certs to secure the communication between guard server and Kubernetes api server. Guard also uses the <code>CommonName</code> and <code>Organization</code> in client certificate to identify which auth provider to use. Follow the steps below to initialize a self-signed ca, generate a pair of server and client certificates.</p>

<pre><code class="language-console"># initialize self signed ca
$ guard init ca
Wrote ca certificates in  /home/tamal/.guard/pki

# generate server certificate pair
$ guard init server --ips=10.96.10.96
Wrote server certificates in  /home/tamal/.guard/pki

# generate client certificate pair for Github organization `appscode`
$ guard init client appscode -o github
Wrote client certificates in  /home/tamal/.guard/pki

$ guard init client appscode.com -o google
Wrote client certificates in  /home/tamal/.guard/pki

$ guard init client qacode -o appscode
Wrote client certificates in  /home/tamal/.guard/pki

# generate client certificate pair for Gitlab
$ guard init client -o gitlab
Wrote client certificates in  /home/tamal/.guard/pki

# for azure, commonName is optional
$ guard init client -o azure
Wrote client certificates in  /home/tamal/.guard/pki

# generate client certificate pair for LDAP
$ guard init client appscode -o ldap
Wrote client certificates in  /home/tamal/.guard/pki

$ ls -l /home/tamal/.guard/pki
total 32
-rwxr-xr-- 1 tamal tamal 1054 Aug 28 07:42 qacode@appscode.crt
-rw------- 1 tamal tamal 1679 Aug 28 07:42 qacode@appscode.key
-rwxr-xr-- 1 tamal tamal 1054 Aug 28 07:42 appscode.com@google.crt
-rw------- 1 tamal tamal 1679 Aug 28 07:42 appscode.com@google.key
-rwxr-xr-- 1 tamal tamal 1050 Aug 28 07:12 appscode@github.crt
-rw------- 1 tamal tamal 1675 Aug 28 07:12 appscode@github.key
-rwxr-xr-- 1 tamal tamal 1050 Aug 28 07:12 gitlab@gitlab.crt
-rw------- 1 tamal tamal 1675 Aug 28 07:12 gitlab@gitlab.key
-rwxr-xr-- 1 tamal tamal 1050 Aug 28 07:12 azure@azure.crt
-rw------- 1 tamal tamal 1675 Aug 28 07:12 azure@azure.key
-rwxr-xr-- 1 tamal tamal 1050 Aug 28 07:12 ldap@ldap.crt
-rw------- 1 tamal tamal 1675 Aug 28 07:12 ldap@ldap.key
-rwxr-xr-- 1 tamal tamal 1005 Aug 28 07:12 ca.crt
-rw------- 1 tamal tamal 1675 Aug 28 07:12 ca.key
-rwxr-xr-- 1 tamal tamal 1046 Aug 28 07:12 server.crt
-rw------- 1 tamal tamal 1675 Aug 28 07:12 server.key
</code></pre>

<p>As you can see, Guard stores the generated certificates in <code>.guard</code> subdirectory of home directory of user executing these commands. You can change the location by either setting <code>GUARD_DATA_DIR</code> environment variable or by passing the path to a different directory using <a href="https://github.com/appscode/guard/pull/25"><code>--pki-dir</code></a> flag. For example:</p>

<pre><code class="language-console">$ export GUARD_DATA_DIR=/tmp/guard

$ guard init ca
I0621 14:09:30.582429   17769 types.go:16] Using data dir /tmp/guard found in GUARD_DATA_DIR env variable
I0621 14:09:30.606327   17769 logs.go:19] FLAG: --alsologtostderr=&quot;false&quot;
I0621 14:09:30.606350   17769 logs.go:19] FLAG: --analytics=&quot;true&quot;
I0621 14:09:30.606356   17769 logs.go:19] FLAG: --help=&quot;false&quot;
I0621 14:09:30.606363   17769 logs.go:19] FLAG: --log_backtrace_at=&quot;:0&quot;
I0621 14:09:30.606369   17769 logs.go:19] FLAG: --log_dir=&quot;&quot;
I0621 14:09:30.606377   17769 logs.go:19] FLAG: --logtostderr=&quot;false&quot;
I0621 14:09:30.606385   17769 logs.go:19] FLAG: --pki-dir=&quot;/tmp/guard&quot;
I0621 14:09:30.606392   17769 logs.go:19] FLAG: --stderrthreshold=&quot;0&quot;
I0621 14:09:30.606407   17769 logs.go:19] FLAG: --v=&quot;0&quot;
I0621 14:09:30.606415   17769 logs.go:19] FLAG: --vmodule=&quot;&quot;
Wrote ca certificates in  /tmp/guard/pki
</code></pre>

<p>Guard can use <a href="/products/guard/0.2.0/guides/">supported authenticator</a> to authenticate users for a Kubernetes cluster. A Kubernetes cluster can use one of these organization to authenticate users. But you can configure a single Guard server to perform authentication for multiple clusters, where each cluster uses a different auth provider.</p>

<h2 id="deploy-guard-server">Deploy Guard server</h2>

<p>Now deploy Guard server so that your Kubernetes api server can access it. Use the command below to generate YAMLs for your particular setup. Then use <code>kubectl apply -f</code> to install Guard server.</p>

<pre><code class="language-console"># generate Kubernetes YAMLs for deploying guard server
$ guard get installer \
    --auth-providers=&lt;auth_providers_name&gt; \
    &gt; installer.yaml

$ kubectl apply -f installer.yaml
</code></pre>

<p>By default, the installer.yaml will deploy Guard server on master instances. If your cluster is provisioned by Kubespray, change
the node selector in installer.yaml to <code>&quot;node-role.kubernetes.io/master&quot;: &quot;true&quot;</code> due to <a href="https://github.com/kubernetes-incubator/kubespray/issues/2108">kubernetes-incubator/kubespray#2108</a>.</p>

<h2 id="configure-kubernetes-api-server">Configure Kubernetes API Server</h2>

<p>To use webhook authentication, you need to set <code>--authentication-token-webhook-config-file</code> flag of your Kubernetes api server to a <a href="https://kubernetes.io/docs/admin/authentication/#webhook-token-authentication">kubeconfig file</a> describing how to access the Guard webhook service. You can use the following command to generate a sample <code>kubeconfig</code> file.</p>

<pre><code class="language-console"># print auth token webhook config file. Change the server address to your guard server address.
$ guard get webhook-config appscode -o github --addr=10.96.10.96:443

apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN1RENDQWFDZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFOTVFzd0NRWURWUVFERXdKallUQWUKRncweE56QTRNamt4TkRJek16aGFGdzB5TnpBNE1qY3hOREl6TXpoYU1BMHhDekFKQmdOVkJBTVRBbU5oTUlJQgpJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBclF3aGRweVE3KzBaVzBDMFpEblI1VS85CjdaVmgyODRtYjdYSmVVaHM0QmI0UHE2Mk1remZpc2lzdXZQZmJzK2Y3dW1oeXhyOGVLak10RlJyc3ZQakhUeDUKTG5rM0hvdE1wNGtCbGJjOTl4dExqN0VwazlXSVNNUW42OEo4K0NCU2N3aFZ1Zlg4NndrNFo3cTZuYXdEUTlRbApyMG1qNWZCVFZ1K3gzYWhXa1F4Rzczd3QxRUdZRkRFMFR1UlV6OXpDclk2bFZzdnZJcXlHL04wWHlUVHNMeFQxCmtOOHRnU3cwVWJOakhGMFVmejhpN05wK1RBZkRFT1pUMWx3SllkSlJ2RjMvYTBRRmdHWTg3K1BJQmhvQklZd1YKU2RXZkRjVWVjcUVuWXkxMEF5MDhZeEZxUTlSNTM4djlpUUxYenZqSVdsYWdDSXBCejB2UDB3dFp4a0lGaFFJRApBUUFCb3lNd0lUQU9CZ05WSFE4QkFmOEVCQU1DQXFRd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBTkJna3Foa2lHCjl3MEJBUXNGQUFPQ0FRRUFsanRtbzJwMklvVmhKTXZ4MEFNM08xUkxHMGVRbHY5QTNQWm14dTlWemJkaWZjUFYKTWFaeHp3blVtcjRFa2Y2RmY4WGI4Sk90ZWJUdWo4eDA4UWVaSFRnY3JJYitXdk9jVHJLTkFyeE1Ud0JHcnRRTwp0eWhxanJUSXE5SS9kZUNNeCt4RkNPSFVzdmNEa1FmRVVoZ21YWW5TVEdOU3poNmFmdlU5STFUVUNlWXRFeHlDCm5aaDlPd3hzcGFmcFhBRWdmdStTL0F6WFpLV255bjgyVHpGVTZnaFpFZnVDcndMd2JQRmlaS25ESm1mYlNWM1YKVGljTWdsSkNmZldsdk96OUN3eGtxQlRHNDZvUGZraFZVNElKS3pwekVXQXU2Q3lua09RalkvN2VDd1VFc1NWMQpwM0hZTXpNa05aRzlDNldSakd4VlF4NUo4djRuR1UzcXo2UTk4dz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    server: https://10.96.10.96:443/apis/authentication.k8s.io/v1/tokenreviews
  name: guard-server
contexts:
- context:
    cluster: guard-server
    user: appscode@Github
  name: webhook
current-context: webhook
kind: Config
preferences: {}
users:
- name: appscode@Github
  user:
    client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUMyakNDQWNLZ0F3SUJBZ0lJQTZJZmR0dEIzTlV3RFFZSktvWklodmNOQVFFTEJRQXdEVEVMTUFrR0ExVUUKQXhNQ1kyRXdIaGNOTVRjd09ESTVNVFF5TXpNNFdoY05NVGd3T0RJNU1UUXlOREEwV2pBa01ROHdEUVlEVlFRSwpFd1pIYVhSb2RXSXhFVEFQQmdOVkJBTVRDR0Z3Y0hOamIyUmxNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DCkFROEFNSUlCQ2dLQ0FRRUE3NG5nc25IcldkeHovZUNWdEVwVUdVcmQ1dWkwSVhteGFkZlVuM3hpVTduZHdsYzgKc2loT1hLQ2pEaWM5cjZweW16MTJ5Ry93WCtZM1diOUU5a0VxQzg5L2oyR0ZrSFNVOU40VFlsQlZka0pSRUQ2dAoySjZpVnNPZE9BeE9MeDNidG5QR3RYNi9KRTZSTVFCLzhkcUYyenFUZm5ST3FFNFE0N01wL0NKYmdkcEpjbm9mCmdKVzN5Z2pJYk96WHhIZVNNcjlIclhveGRLbGFPVk1hU3BmY0RVREZrQXV1MEREZCszT3hwbG03TlNpS2JpbnUKM0d3VDc4YkRtNzZCTCtEOWhKeXB2OVZDTFkyMVB3WnB3ejJmaThYdzN2WDM3VVdPenA0OXlCMyttYnVjWkpGSgpCRTNORVJyZFVvWFhyeUJrdDhEdXp0SzhYM3dhOExGdmsvOWxWd0lEQVFBQm95Y3dKVEFPQmdOVkhROEJBZjhFCkJBTUNCYUF3RXdZRFZSMGxCQXd3Q2dZSUt3WUJCUVVIQXdJd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFFN0YKZkdpOWpDSzc0eGZZdmY3b3Byb1NxSVpoYmdyODVkcENCZ2FVbEhlK0ZJYkpVeWhnL2c2OVNCOUlhWitpTWYxNgpNWkJVTWs4Tmg5dUZWYWVQVUdCWG0vTUtBeGx0V0J0UHh0VFFMV0cycU9LbXczK3Z5UUJ4R2JMaytycndXVS9YCjR5SzcxbWc5ZG5GVXdWOGI2UWtwM1IxMVdCZzlCeHExU1RQL210S2NyNVVDS3ZWVmlEYlpobzRkRy9ZUHdMbEUKS1N4UGtqS3NPVU54dDlHZkdNTHVRMVFQWXZDYTZjZ1MxN3BERWZacWVqdmthc0UxeTNSQWpPa2pubTJ2KzIzbgpBN2kxYWwwMDZjTEpQdTl3S3IyMzhJQ0Q3N2ZxQzhTaXJhN3V3NUgxbkVvMTh1am94NmI2UG5XazdmeTZabDRHCjBWMXBCSDJtL1JqK0RudGVTM0k9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    client-key-data: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcFFJQkFBS0NBUUVBNzRuZ3NuSHJXZHh6L2VDVnRFcFVHVXJkNXVpMElYbXhhZGZVbjN4aVU3bmR3bGM4CnNpaE9YS0NqRGljOXI2cHltejEyeUcvd1grWTNXYjlFOWtFcUM4OS9qMkdGa0hTVTlONFRZbEJWZGtKUkVENnQKMko2aVZzT2RPQXhPTHgzYnRuUEd0WDYvSkU2Uk1RQi84ZHFGMnpxVGZuUk9xRTRRNDdNcC9DSmJnZHBKY25vZgpnSlczeWdqSWJPelh4SGVTTXI5SHJYb3hkS2xhT1ZNYVNwZmNEVURGa0F1dTBERGQrM094cGxtN05TaUtiaW51CjNHd1Q3OGJEbTc2QkwrRDloSnlwdjlWQ0xZMjFQd1pwd3oyZmk4WHczdlgzN1VXT3pwNDl5QjMrbWJ1Y1pKRkoKQkUzTkVScmRVb1hYcnlCa3Q4RHV6dEs4WDN3YThMRnZrLzlsVndJREFRQUJBb0lCQVFDam9LdTlPZFJyTGd5TwpBRHhEVEFMbXhCMlEvcVVOdVBOWU9mY2tldk12L21kZHVmbmNPV3hPR2UxSVhjWGxtYWx3SWl4aC94VlViUTZpClgrWGIwZWZHNlpkWmVtU2lxUUNYeEp1NUxPYzBRVmplbi9KaFp2dStDU0g4aDJ0aEJDUnlIZVEvVnJWN043QTIKcVFDOVZXamF1TWpJT09zQ1RWRjhPWWNVbE9PdGJ2MFFRSUFNRDdxak1jcTdIRlJMbjlHSXJjSGVZWTd2RTdONQpucFdOMWZOT25BZXNnaVNRcGYxdGNYcmJUckNkb1JweExlU2RFUngyVnBkdFE1V3hFTm9YYURJT3FJVXB2anJaCjIwSUZqazY3eVVOTlBCLzJkU3VmZzVaekxEYWNGUy9lenYvUDVJYnVEazBHZWQyZGhkT2t3K2duVFNabjg0Sk4KMDg4TlMvVUJBb0dCQVBGOG44dEVmTURDNjlTc1RGWWh4NUc2aE1PWThlS0kxTDJQeTVVaEN4WCtXUlpoQndaVQpWaGhVMVpOcTgvUXkwb201WEQyT1UwR0tGQjY3aE9kU1l6TUc3a0NqKzl3bHZDM0loRmxLd2R1ZC8relBWTFkvCngxRjFtVnA3aTllZXZiZmdZdUQxdDRvTDVxc2lveldGZ2g2UndSZzVWTXpGd0N2WXZwUk9CcGZUQW9HQkFQM3YKUjNyRit1cW96YU9IcldrUjFEL3E5MHlRd3ZpamlRWDhyNEg3QVZTVVpnQmhwbEpmUDRTVU84NWdUbmhBLzl4ZQp3R1NTQzFGWkpVeDRmOW41MFN0dFlkNFhIMTZiU1lyOEpWQWxVRWY5QWR1czBkc1pKdkZLSEM5S3VjNEFPeUFPClYvUGR0Rk1FV2J5WERSQXdBTTVwNzZsU1pZVXA5cDFLVTZ6SndHM3RBb0dCQUlmdzdRK0RmV3NTRDZwSVdDekEKbFZUL0Y4LzRZR3B6TnJlRHBFcE9NS3h2NDN6S29DYTdBVUJ2T1Uva2pISnl6YnlFSVYzeHFnS2lGVk43b29TSwpCNWZwRmVSRHEvdXhMbTdqaTBXczVOYVo2a0ZJTWRycXFteTc4OWxRNVZjN1lIZUxsSDRwTk9vOGF0ejZBY0NXCmFMcUd1Sm5IWkdwbUJCbHF5Vlk1V2xMTEFvR0FPWVlBelVFWURCeGRLUlJOSmlZUnpNRHZjSHJDa0F5THQ3MTgKREpmTnYxazJtaE9FMTlnWHpYSys4WXREZTE1T0Y1K25PYUVUeTBQRWZVUTJ3aXdqUkJFdFFHQkFqTy9rZ3dXSApkbFpkajFFeklJNVBvN0JZOEFQM3lvYkUvSE4wOFZnT2VJSGFuWXU0d0UzL2VaRkdQWHdsL0ZkY0JBUnpoMElWCkhtazluQ2tDZ1lFQXJyNGQ3WFBUNlBvTTA5TjFSYnVtQnROUW96cGxpb0wwb0tqZUxHL0RHcUd5Q3lpcDVsNnMKUW5vblpPcW9BVzdqZlRiMThvVVVzVkJTdDJvd20zempac05XZFdZcEptL1ZCSDQvY0dOeFJuSXN1OFNsdFdBZAp1YjVZQS9YcnEvUTRNcUJnZEVwYm9HTnlzUVlscE0rMmxHZWpiZ0pDUTI4b3dJYndLQ3JSY2t3PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
</code></pre>

<h2 id="using-guard-service-name-instead-of-ip-in-authentication-webhook-config-file">Using Guard service name instead of IP in authentication webhook config file</h2>

<p>So far, we have used a preset ClusterIP address in Guard service. This cluster ip was used in the authentication webhook config file and used by Kubernetes api server to connect to guard server.</p>

<p>It is possible to use Guard service name in authentication webhook config file so that Kubernetes api server connects to Guard using its domain name. This requires the following additional steps:</p>

<ul>
<li><p>Since Kubernetes api server pod uses <code>HostNetwok</code>, change the DNS policy for Kubernetes api server to <a href="https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/#pods-dns-policy"><code>ClusterFirstWithHostNet</code></a>. The actual process depends on your cluster provisioning process. Usually this involves updating the kube-apiserver manifest file in /etc/kubernetes/manifests folder in Master machines.</p></li>

<li><p>When issuing server certificate for Guard server, provide the domain name so that it is included in CN/SANS for server cert.</p></li>
</ul>

<pre><code class="language-console">$ guard init server --domains=guard.&lt;namespace&gt;.svc
</code></pre>

<ul>
<li>Now, pass the Guard service name when generating webhook config.</li>
</ul>

<p>`<code>console
$ guard get webhook-config appscode -o github --addr=guard.&lt;namespace&gt;.svc:443
</code></p>

        </div>
      </div>
      <div class="column is-2">
        <div class="right-sidebar-area">
          
          <div class="search-area">
            <form action="#">
              <input type="text" placeholder="Search..." />
              <button class="search-button">
                <i class="fa fa-search" aria-hidden="true"></i>
              </button>
            </form>
          </div>
          

          
          <div class="tbl-of-contents">
            <h4>What's on this Page</h4>
            <nav id="TableOfContents">
<ul>
<li><a href="#installation-guide">Installation Guide</a>
<ul>
<li><a href="#install-guard-as-cli">Install Guard as CLI</a></li>
<li><a href="#initialize-pki">Initialize PKI</a></li>
<li><a href="#deploy-guard-server">Deploy Guard server</a></li>
<li><a href="#configure-kubernetes-api-server">Configure Kubernetes API Server</a></li>
<li><a href="#using-guard-service-name-instead-of-ip-in-authentication-webhook-config-file">Using Guard service name instead of IP in authentication webhook config file</a></li>
</ul></li>
</ul>
</nav>
          </div>
          
        </div>
      </div>
    </div>
  </div>
  <script>
    
    var kdDropdown = document.querySelector(".dropdown");
    var kdDropdownBtn = document.querySelector(".dropdown-trigger");
      kdDropdownBtn.addEventListener("click", function(){
        kdDropdown.classList.toggle("is-active");
      })
  </script>
</div>



    
    
<section></section>

    

    
    
<section></section>

    

    
    
    <section class="cta-area section-padding pt-0">
      <div class="container section">
        <div class="cta-padding">
          <div class="columns">
            <div class="column is-6">
              
              <div class="cta-text">
                <h2>Ready to get Start?</h2>
                <p>Create a Free Account and refer your friend</p>
              </div>
              
            </div>
            <div class="column is-6 has-text-right is-mobile">
              <div class="cta-button d-table">
                
                <div class="cta-button-inner d-table-cell">
                  <a href="#" class="button kd-button kd-primary"
                    >Try Now for FREE</a
                  >
                </div>
                
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    
    

    
    
    <footer class="footer-area">
      <div class="footer-top">
        <div class="container section">
          <div class="columns">
            <div class="column is-4">
              <div class="single-footer-widget">
                
                <div class="footer-logo">
                  <a href="#"
                    ><img
                      src="/assets/images/logo-color-appscode.png"
                      alt=""
                      class="img"
                  /></a>
                </div>
                

                
                <div class="subscription-form">
                  <form action="#">
                    <label for="email">Subscribe Our Newsletter</label>
                    <div class="field has-addons">
                      <div class="control">
                        <input
                          class="input"
                          name="email"
                          id="email"
                          type="email"
                          placeholder="info@gmail.com"
                        />
                      </div>
                      <div class="control">
                        <a class="button kd-primary">
                          <i class="fa fa-paper-plane-o" aria-hidden="true"></i>
                        </a>
                      </div>
                    </div>
                  </form>
                </div>
                

                
                <div class="contact-information">
                  <h4>Have any Inquiry?</h4>
                  <ul class="all-contact-info">
                    <li>
                      <a href="callto:+123456789"
                        ><span
                          ><i class="fa fa-phone" aria-hidden="true"></i></span
                        >+123 456 789</a
                      >
                    </li>

                    <li>
                      <a href="mailto:appscode@gmail.com"
                        ><span
                          ><i
                            class="fa fa-envelope-o"
                            aria-hidden="true"
                          ></i></span
                        >appscode@gmail.com</a
                      >
                    </li>
                  </ul>
                </div>
                
              </div>
            </div>

            <div class="column is-2">
              <div class="single-footer-widget">
                
                <div class="footer-menu">
                  <h4>Products</h4>
                  <ul class="footer-link">
                    <li><a href="#">Voyager</a></li>
                    <li><a href="#">KubeDB</a></li>
                    <li><a href="#">Pharmer Stash </a></li>
                    <li><a href="#">Service Broker</a></li>
                    <li><a href="#">Kubed</a></li>
                    <li><a href="#">Guard</a></li>
                    <li><a href="#">Swift</a></li>
                    <li><a href="#">Searchlight</a></li>
                  </ul>
                </div>
                
              </div>
            </div>

            <div class="column is-2">
              <div class="single-footer-widget">
                
                <div class="footer-menu">
                  <h4>Offerings</h4>
                  <ul class="footer-link">
                    <li><a href="#">Products</a></li>
                    <li><a href="#">Services</a></li>
                    <li><a href="#">Open source </a></li>
                  </ul>
                </div>
                
              </div>
            </div>

            <div class="column is-2">
              <div class="single-footer-widget">
                
                <div class="footer-menu">
                  <h4>Company</h4>
                  <ul class="footer-link">
                    <li><a href="#">About Us</a></li>
                    <li><a href="#">blog</a></li>
                    <li><a href="#">Seles Inquiry</a></li>
                    <li><a href="#">Contact Us</a></li>
                  </ul>
                </div>
                
              </div>
            </div>

            <div class="column is-2">
              <div class="single-footer-widget">
                
                <div class="footer-menu">
                  <h4>Legal</h4>
                  <ul class="footer-link">
                    <li><a href="#">Service Level Agreement</a></li>
                    <li><a href="#">Security</a></li>
                    <li><a href="#">Learn More</a></li>
                    <li><a href="#">Contact Us</a></li>
                  </ul>
                </div>
                
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="footer-bottom">
        <div class="container section">
          <div class="columns">
            <div class="column is-4">
              <p>All rights reserved © 2018. Appscode, Inc..</p>
            </div>
            <div class="column is-4 is-mobile has-text-centered">
              <div class="footer-inline-link">
                <a href="#">Privacy Policy</a>
                <a href="#">Terms of Service</a>
              </div>
            </div>
            <div class="column is-4 is-mobile has-text-right">
              <div class="socail-link-inline">
                <ul>
                  <li>
                    <a href="#"
                      ><i class="fa fa-twitter" aria-hidden="true"></i
                    ></a>
                  </li>
                  <li>
                    <a href="#"
                      ><i class="fa fa-facebook" aria-hidden="true"></i
                    ></a>
                  </li>
                  <li>
                    <a href="#"
                      ><i class="fa fa-github" aria-hidden="true"></i
                    ></a>
                  </li>
                  <li>
                    <a href="#"
                      ><i class="fa fa-youtube" aria-hidden="true"></i
                    ></a>
                  </li>
                  <li>
                    <a href="#"
                      ><i class="fa fa-twitter" aria-hidden="true"></i
                    ></a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </footer>
    
    

    
    <script src="/assets/js/bulma-carousel.min.js"></script>
    
    <script src="/assets/js/main.js"></script>
  </body>
</html>
