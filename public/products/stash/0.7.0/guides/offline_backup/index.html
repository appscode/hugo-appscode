

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <meta name="theme-color" content="#2D9AED" />
    
    <title>Stash Home</title>
    
    
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
    
    <link rel="stylesheet" href="/assets/css/font-awesome.min.css" />
    
    <link rel="stylesheet" href="/assets/css/bulma-carousel.min.css" />
    
    <link rel="stylesheet" href="/assets/css/bulma.min.css" />
    
    
    <link rel="stylesheet" href="/assets/sass/main.css" />
    
    
    
    <link rel="stylesheet" href="/assets/css/responsive.min.9b1604560832c2ed8703716da193a1ed179feba7fd4d7d15d940c1d19bfc5c17.css" />
    
  </head>

  <body class="stash">
    

    
    
    <header>
      
      
      <div class="header-top">
        <div class="container section">
          <nav class="navbar">
            <div class="navbar-brand">
              <a class="navbar-item" href="https://appscode-v3-hugo.web.app">
                <img src="/assets/images/logo-color-appscode.png" alt="" />
              </a>

              <a
                role="button"
                class="navbar-burger burger"
                aria-label="menu"
                aria-expanded="false"
                data-target="acNav1"
              >
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
              </a>
            </div>

            <div id="acNav1" class="navbar-menu main-menu">
              <div class="navbar-end">
                
                <div class="navbar-start">
                  <div class="navbar-item has-dropdown ac-is-hoverable">
                    <a class="navbar-link">
                      Products
                    </a>

                    
                    <div class="ac-megamenu">
                      <div class="columns">
                        <div class="column is-8">
                          <div class="columns">
                            <div class="column is-6 br-1">
                              
                              <a
                                href="https://appscode-v3-hugo.web.app/products/voyager/"
                                class="single-product-item is-voyager"
                              >
                                <div class="menu-header">
                                  <div class="menu-logo">
                                    <img
                                      src="/assets/images/product-logo/appscode.png"
                                      alt=""
                                    />
                                  </div>
                                  <h5>Voyager</h5>
                                </div>
                                <div class="menu-body">
                                  <p>
                                    Secure HAProxy Ingress Controller for Kubernetes
                                  </p>
                                </div>
                              </a>
                              
                              
                              <a
                                href="https://kubedb-v2-hugo.web.app"
                                class="single-product-item is-kubedb"
                              >
                                <div class="menu-header">
                                  <div class="menu-logo">
                                    <img
                                      src="/assets/images/product-logo/kubedb.png"
                                      alt=""
                                    />
                                  </div>
                                  <h5>KubeDB</h5>
                                </div>
                                <div class="menu-body">
                                  <p>
                                    Run production-grade databases easily on Kubernetes
                                  </p>
                                </div>
                              </a>
                              
                              
                              <a
                                href="https://appscode-v3-hugo.web.app/products/stash/"
                                class="single-product-item is-stash"
                              >
                                <div class="menu-header">
                                  <div class="menu-logo">
                                    <img
                                      src="/assets/images/product-logo/appscode.png"
                                      alt=""
                                    />
                                  </div>
                                  <h5>Stash</h5>
                                </div>
                                <div class="menu-body">
                                  <p>
                                    Backup your Kubernetes Stateful Applications
                                  </p>
                                </div>
                              </a>
                              
                              
                              <a
                                href="https://appscode-v3-hugo.web.app/products/guard/"
                                class="single-product-item is-guard"
                              >
                                <div class="menu-header">
                                  <div class="menu-logo">
                                    <img
                                      src="/assets/images/product-logo/appscode.png"
                                      alt=""
                                    />
                                  </div>
                                  <h5>Guard</h5>
                                </div>
                                <div class="menu-body">
                                  <p>
                                    Kubernetes Authentication WebHook Server
                                  </p>
                                </div>
                              </a>
                              
                              
                              <a
                                href="https://kubeci-v1-hugo.web.app"
                                class="single-product-item is-kubeci"
                              >
                                <div class="menu-header">
                                  <div class="menu-logo">
                                    <img
                                      src="/assets/images/product-logo/appscode.png"
                                      alt=""
                                    />
                                  </div>
                                  <h5>KubeCI</h5>
                                </div>
                                <div class="menu-body">
                                  <p>
                                    Kubernetes native CI
                                  </p>
                                </div>
                              </a>
                              
                            </div>
                            <div class="column is-6 br-1">
                              
                              <a
                                href="https://appscode-v3-hugo.web.app/products/searchlight/"
                                class="single-product-item is-searchlight"
                              >
                                <div class="menu-header">
                                  <div class="menu-logo">
                                    <img
                                      src="/assets/images/product-logo/appscode.png"
                                      alt=""
                                    />
                                  </div>
                                  <h5>Searchlight</h5>
                                </div>
                                <div class="menu-body">
                                  <p>
                                    Alerts for Kubernetes
                                  </p>
                                </div>
                              </a>
                              
                              
                              <a
                                href="https://appscode-v3-hugo.web.app/products/swift/"
                                class="single-product-item is-swift"
                              >
                                <div class="menu-header">
                                  <div class="menu-logo">
                                    <img
                                      src="/assets/images/product-logo/appscode.png"
                                      alt=""
                                    />
                                  </div>
                                  <h5>Swift</h5>
                                </div>
                                <div class="menu-body">
                                  <p>
                                    Ajax friendly Helm Tiller Proxy
                                  </p>
                                </div>
                              </a>
                              
                              
                              <a
                                href="https://appscode-v3-hugo.web.app/products/service-broker/"
                                class="single-product-item is-broker"
                              >
                                <div class="menu-header">
                                  <div class="menu-logo">
                                    <img
                                      src="/assets/images/product-logo/kubedb.png"
                                      alt=""
                                    />
                                  </div>
                                  <h5>Service Broker</h5>
                                </div>
                                <div class="menu-body">
                                  <p>
                                    Open Service Broker for AppsCode Cloud Services
                                  </p>
                                </div>
                              </a>
                              
                              
                              <a
                                href="https://appscode-v3-hugo.web.app/products/pharmer/"
                                class="single-product-item is-pharmer"
                              >
                                <div class="menu-header">
                                  <div class="menu-logo">
                                    <img
                                      src="/assets/images/product-logo/appscode.png"
                                      alt=""
                                    />
                                  </div>
                                  <h5>Pharmer</h5>
                                </div>
                                <div class="menu-body">
                                  <p>
                                    Kubernetes Cluster Manager using Kubeadm & Cluster API
                                  </p>
                                </div>
                              </a>
                              
                              
                              <a
                                href="https://kubeshield-v1-hugo.web.app"
                                class="single-product-item is-kubeshield"
                              >
                                <div class="menu-header">
                                  <div class="menu-logo">
                                    <img
                                      src="/assets/images/product-logo/appscode.png"
                                      alt=""
                                    />
                                  </div>
                                  <h5>KubeShield</h5>
                                </div>
                                <div class="menu-body">
                                  <p>
                                    Secure Kubernetes
                                  </p>
                                </div>
                              </a>
                              
                            </div>
                          </div>
                        </div>
                        <div class="column is-4">
                          
                          <a
                            href="https://byte.builders"
                            class="single-product-item byte-builder kd-orange"
                          >
                            <div class="menu-header">
                              <p class="intro">Introducing....</p>
                              <h5>Byte.builders</h5>
                            </div>
                            <div class="menu-body">
                              <p>
                                The Kubernetes Cloud
                              </p>
                            </div>
                            <p class="learn-more-btn">
                              Learn more
                              <span class="icon"
                                ><i
                                  class="fa fa-long-arrow-right"
                                  aria-hidden="true"
                                ></i
                              ></span>
                            </p>
                          </a>
                          

                          
                          <a
                            href="https://appscode-v3-hugo.web.app/products/kubed/"
                            class="single-product-item is-kubed"
                          >
                            <div class="menu-header">
                              <div class="menu-logo">
                                <img
                                  src="/assets/images/product-logo/appscode.png"
                                  alt=""
                                />
                              </div>
                              <h5>Kubed</h5>
                            </div>
                            <div class="menu-body">
                              <p>
                                A Kubernetes cluster manager daemon
                              </p>
                            </div>
                          </a>
                          
                          
                          <a
                            href="https://kubevault-v1-hugo.web.app"
                            class="single-product-item is-kubevault"
                          >
                            <div class="menu-header">
                              <div class="menu-logo">
                                <img
                                  src="/assets/images/product-logo/appscode.png"
                                  alt=""
                                />
                              </div>
                              <h5>KubeVault</h5>
                            </div>
                            <div class="menu-body">
                              <p>
                                Tools for running HashiCorp Vault on Kubernetes
                              </p>
                            </div>
                          </a>
                          
                        </div>
                      </div>
                      <div class="columns has-text-centered">
                        <div class="column">
                          <div class="menu-bottom">
                            <p>
                              Explore refreshing apps and integrations for
                              AppsCode products:
                              <a href="https://marketplace.byte.builders">
                                Visit the Marketplace
                                <i
                                  class="fa fa-long-arrow-right"
                                  aria-hidden="true"
                                ></i
                              ></a>
                            </p>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                  </div>

                  <a class="navbar-item">
                    Services
                  </a>
                  <a class="navbar-item">
                    Open Source
                  </a>
                  <a class="navbar-item">
                    Blog
                  </a>
                  <a class="navbar-item">
                    Contact
                  </a>
                </div>
                
                <div class="navbar-item">
                  <div class="buttons main-menu-button-top">
                    <a class="button is-small for-support">
                      <span
                        ><img
                          src="/assets/images/icon/chat.png"
                          alt=""/></span
                      >Forum
                    </a>
                    <a class="button is-small for-chat">
                      <span
                        ><img
                          src="/assets/images/icon/slack.png"
                          alt=""/></span
                      >Chat
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </nav>
        </div>
      </div>
      
      

      

      

      
      <div
        class="header-bottom-area header-area kubedb-primary-bg customize-kubedb"
        id="header"
      >
        <div class="container section">
          <nav class="navbar">
            <div class="navbar-brand">
              
                <a class="navbar-item" href="https://appscode-v3-hugo.web.app/products/stash">
                  <img src="/assets/images/stash-white.png" alt="" />
                </a>
              

              <a
                role="button"
                class="navbar-burger burger"
                aria-label="menu"
                aria-expanded="false"
                data-target="acNav"
              >
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
              </a>
            </div>

            <div id="acNav" class="navbar-menu main-menu">
              <div class="navbar-end">
                
                  
                    
                    <div class="navbar-start">
                    
                    
                      
                        
                          <a href="/products/stash/features/" class="navbar-item">Features</a>
                        
                      
                    
                      
                        
                          <a href="/products/stash/pricing/" class="navbar-item">Commercial Support</a>
                        
                      
                    
                      
                        
                          <a href="/products/stash/0.8.3/welcome/">Documentation</a>
                        
                      
                    
                      
                        <div class="navbar-item has-dropdown ac-is-hoverable">
                          <a class="navbar-link">Community</a>
                          <div class="ac-dropdown">
                            
                              
                                <a href="https://github.com/kubedb" class="navbar-item">GitHub</a>
                              
                            
                              
                                <a href="https://twitter.com/KubeDB" class="navbar-item">Twitter</a>
                              
                            
                              
                                <a href="https://groups.google.com/forum/#!forum/kubedb" class="navbar-item">Groups</a>
                              
                            
                              
                                <a href="http://slack.kubernetes.io/" class="navbar-item">Slack</a>
                              
                            
                              
                                <a href="http://discourse.appscode.com" class="navbar-item">Forum</a>
                              
                            
                          </div>
                        </div>
                      
                    
                    </div>
                    

                    
                    <div class="navbar-item">
                      <div class="buttons main-menu-button">
                        
                        <a
                          class="github-button"
                          href="https://github.com/stashed/stash"
                          data-size="large"
                          data-show-count="true"
                          aria-label="Star stashed/stash on GitHub"
                        >Star</a>
                        
                        <script async defer src="https://buttons.github.io/buttons.js"></script>
                      </div>
                    </div>
                  
                
              </div>
            </div>
          </nav>
        </div>
      </div>
      
      

      




<div class="kubedb-documentation-menu">
  <div class="container section">
    
    <div class="documentation-menu">
      <div class="container section">
        <div class="columns is-centered">
          <div class="column is-half has-text-centered">
            
            <div class="responsive-menu">
              <a
                role="button"
                class="navbar-burger burger"
                aria-label="menu"
                aria-expanded="false"
                data-target="acNav3"
              >
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
              </a>
            </div>
            
            
            <nav class="documentation-navbar">
              <div id="acNav3" class="navbar-menu nav-menu main-menu">
                <div class="navbar-centered">
                  
                  <div class="navbar-start">
                    
                    
                      
                        
                          <a href="/products/stash/0.7.0/" class=" navbar-item">Welcome</a>
                        
                      
                        
                          <a href="/products/stash/0.7.0/concepts/" class=" navbar-item">Concepts</a>
                        
                      
                        
                          <a href="/products/stash/0.7.0/setup/" class=" navbar-item">Setup</a>
                        
                      
                        
                          <a href="/products/stash/0.7.0/guides/" class=" is-active  navbar-item">Guides</a>
                        
                      
                        
                          <a href="/products/stash/0.7.0/reference/" class=" navbar-item">Reference</a>
                        
                      
                    
                  </div>
                  
                </div>
              </div>
            </nav>
            
          </div>
        </div>
      </div>
    </div>
    
  </div>
</div>


    </header>
    
    

    
    









<div class="documentation-area">
  <div class="container section">
    <div class="columns">
      <div class="column is-3">
        
        <div class="kd-left-sidebar">
          
            
            
            
            

            <div class="trial-button">
              <a href="/products/stash/docs/0.8.3/setup/" class="button is-fullwidth">
                Try Now for FREE!
              </a>
            </div>

            <div class="kd-version">
              <div class="dropdown">
                <div class="dropdown-trigger">
                  <button
                    class="button is-fullwidth"
                    aria-haspopup="true"
                    aria-controls="dropdown-menu3"
                  >

                    
                      
                      
                        
                      
                    
                      
                      
                        
                      
                    
                      
                      
                        
                      
                    
                      
                      
                        
                      
                    
                      
                      
                        
                      
                    
                      
                      
                        
                          <span><strong class="icon"><i class="fa fa-cog" aria-hidden="true"></i></strong>0.7.0</span>
                        
                        
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                        
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                        
                      
                    

                    <span class="icon is-small">
                      <i class="fa fa-angle-down" aria-hidden="true"></i>
                    </span>
                  </button>
                </div>
                <div class="dropdown-menu" id="dropdown-menu3" role="menu">
                  <div class="dropdown-content">
                    
                      
                      
                        
                          <a href="https://github.com/stashed/docs/tree/master/docs" target="_blank" class="dropdown-item">master</a>
                        
                      
                    
                      
                      
                        
                          <a href="/products/stash/0.8.3/" class="dropdown-item">0.8.3   <div class="tag">Latest</div> </a>
                        
                      
                    
                      
                      
                        
                          <a href="/products/stash/0.8.2/" class="dropdown-item">0.8.2  </a>
                        
                      
                    
                      
                      
                        
                          <a href="/products/stash/0.8.1/" class="dropdown-item">0.8.1  </a>
                        
                      
                    
                      
                      
                        
                          <a href="/products/stash/0.8.0/" class="dropdown-item">0.8.0  </a>
                        
                      
                    
                      
                      
                        
                          <a href="/products/stash/0.7.0/" class="dropdown-item">0.7.0  </a>
                        
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                        
                          <a href="/products/stash/0.6.4/" class="dropdown-item">0.6.4  </a>
                        
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                        
                          <a href="https://github.com/stashed/docs/tree/0.4.2/docs" target="_blank" class="dropdown-item">0.4.2</a>
                        
                      
                    
                  </div>
                </div>
              </div>

            </div>
          

          
            
            
              
            
              
            
              
            
              
                
                  

                  
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                    
                  
                
              
            
              
            
          

          
          <div class="kd-sidebar-menu">
            
              

              
              

                
              

                
              

                
              

                
                  

                  
                  

                    
                      




  



<div class="item">
  <input type="checkbox" id="a757e2f2c8273fd00b74ac235ccf12a0-1" >
  <label for="a757e2f2c8273fd00b74ac235ccf12a0-1"><a href="/products/stash/0.7.0/guides/">Guides</a></label>
</div>


                    
                    
                  

                    
                      






<div class="item">
  <input type="checkbox" id="a757e2f2c8273fd00b74ac235ccf12a0-2" >
  <label for="a757e2f2c8273fd00b74ac235ccf12a0-2"><a href="/products/stash/0.7.0/guides/backup/">Backup Volumes</a></label>
</div>


                    
                    
                  

                    
                      






<div class="item">
  <input type="checkbox" id="a757e2f2c8273fd00b74ac235ccf12a0-3" checked>
  <label for="a757e2f2c8273fd00b74ac235ccf12a0-3"><a href="/products/stash/0.7.0/guides/offline_backup/">Offline Backup</a></label>
</div>


                    
                    
                  

                    
                      






<div class="item">
  <input type="checkbox" id="a757e2f2c8273fd00b74ac235ccf12a0-4" >
  <label for="a757e2f2c8273fd00b74ac235ccf12a0-4"><a href="/products/stash/0.7.0/guides/workloads/">Workloads</a></label>
</div>


                    
                    
                  

                    
                      






<div class="item">
  <input type="checkbox" id="a757e2f2c8273fd00b74ac235ccf12a0-5" >
  <label for="a757e2f2c8273fd00b74ac235ccf12a0-5"><a href="/products/stash/0.7.0/guides/restore/">Restore Volumes</a></label>
</div>


                    
                    
                  

                    
                      






<div class="item">
  <input type="checkbox" id="a757e2f2c8273fd00b74ac235ccf12a0-6" >
  <label for="a757e2f2c8273fd00b74ac235ccf12a0-6"><a href="/products/stash/0.7.0/guides/backends/">Backends</a></label>
</div>


                    
                    
                  

                    
                      






<div class="item">
  <input type="checkbox" id="a757e2f2c8273fd00b74ac235ccf12a0-7" >
  <label for="a757e2f2c8273fd00b74ac235ccf12a0-7"><a href="/products/stash/0.7.0/guides/rbac/">RBAC</a></label>
</div>


                    
                    
                  

                    
                      






<div class="item">
  <input type="checkbox" id="a757e2f2c8273fd00b74ac235ccf12a0-8" >
  <label for="a757e2f2c8273fd00b74ac235ccf12a0-8"><a href="/products/stash/0.7.0/guides/minio_server/">Backup to Minio</a></label>
</div>


                    
                    
                  

                    
                      






<div class="item">
  <input type="checkbox" id="a757e2f2c8273fd00b74ac235ccf12a0-9" >
  <label for="a757e2f2c8273fd00b74ac235ccf12a0-9"><a href="/products/stash/0.7.0/guides/monitoring/">Monitoring</a></label>
</div>


                    
                    
                  
                  

                
              

                
              
              
            
          </div>
          
        </div>
        
      </div>
      <div class="column is-7">
        <div class="full-info">
          

<blockquote>
<p>New to Stash? Please start <a href="/products/stash/0.7.0/concepts/README">here</a>.</p>
</blockquote>

<h1 id="offline-backup">Offline Backup</h1>

<p>This tutorial will show you how to backup a Kubernetes deployment using Stash in offline mode. By default, stash takes backup in <a href="/products/stash/0.7.0/guides/backup">online</a> mode where sidecar container is added to take periodic backups and check backups. But sometimes you need to ensure that source data is not being modified while taking the backup, that means running backup while keeping workload pod stopped. In such case, you can run the backup in offline mode. To do this you need to specify <code>spec.type: offline</code> in <code>Restic</code> CRD.</p>

<p>At first, you need to have a Kubernetes cluster, and the kubectl command-line tool must be configured to communicate with your cluster. If you do not already have a cluster, you can create one by using <a href="https://github.com/kubernetes/minikube">Minikube</a>. Now, install Stash in your cluster following the steps <a href="/products/stash/0.7.0/setup/install">here</a>.</p>

<p>In this tutorial, we are going to backup the <code>/source/data</code> folder of a <code>busybox</code> pod into a local backend. First, deploy the following <code>busybox</code> Deployment in your cluster. Here we are using a git repository as a source volume for demonstration purpose.</p>

<pre><code class="language-yaml">apiVersion: apps/v1beta1
kind: Deployment
metadata:
  labels:
    app: stash-demo
  name: stash-demo
  namespace: default
spec:
  replicas: 1
  template:
    metadata:
      labels:
        app: stash-demo
      name: busybox
    spec:
      containers:
      - command:
        - sleep
        - &quot;3600&quot;
        image: busybox
        imagePullPolicy: IfNotPresent
        name: busybox
        volumeMounts:
        - mountPath: /source/data
          name: source-data
      restartPolicy: Always
      volumes:
      - gitRepo:
          repository: https://github.com/appscode/stash-data.git
        name: source-data
</code></pre>

<pre><code class="language-console">$  kubectl apply -f ./docs/examples/tutorial/busybox.yaml
deployment &quot;stash-demo&quot; created
</code></pre>

<p>Run the following command to confirm that <code>busybox</code> pods are running.</p>

<pre><code class="language-console">$ kubectl get pods -l app=stash-demo
NAME                          READY     STATUS    RESTARTS   AGE
stash-demo-788ffcf9c6-p5kxc   1/1       Running   0          12s
</code></pre>

<p>Now, create a <code>Secret</code> that contains the key <code>RESTIC_PASSWORD</code>. This will be used as the password for your restic repository.</p>

<pre><code class="language-console">$ kubectl create secret generic stash-demo --from-literal=RESTIC_PASSWORD=changeit
secret &quot;stash-demo&quot; created
</code></pre>

<p>You can check that the secret was created like this:</p>

<pre><code class="language-yaml">$ kubectl get secret stash-demo -o yaml

apiVersion: v1
data:
  RESTIC_PASSWORD: Y2hhbmdlaXQ=
kind: Secret
metadata:
  creationTimestamp: 2017-12-04T05:24:22Z
  name: stash-demo
  namespace: default
  resourceVersion: &quot;22328&quot;
  selfLink: /api/v1/namespaces/default/secrets/stash-demo
  uid: 62aa8ef8-d8b3-11e7-be92-0800277f19c0
type: Opaque
</code></pre>

<p>Now, create a <code>Restic</code> CRD with selectors matching the labels of the <code>busybox</code> Deployment and <code>spec.type: offline</code>.</p>

<pre><code class="language-console">$ kubectl apply -f ./docs/examples/tutorial/restic_offline.yaml
restic &quot;stash-demo&quot; created
</code></pre>

<pre><code class="language-yaml">apiVersion: stash.appscode.com/v1alpha1
kind: Restic
metadata:
  name: stash-demo
  namespace: default
spec:
  selector:
    matchLabels:
      app: stash-demo
  type: offline
  fileGroups:
  - path: /source/data
    retentionPolicyName: 'keep-last-5'
  backend:
    local:
      mountPath: /safe/data
      hostPath:
        path: /data/stash-test/restic-repo
    storageSecretName: stash-demo
  schedule: '@every 5m'
  volumeMounts:
  - mountPath: /source/data
    name: source-data
  retentionPolicies:
  - name: 'keep-last-5'
    keepLast: 5
    prune: true
</code></pre>

<p>When a <code>Restic</code> is created with <code>spec.type: offline</code>, stash operator adds an <a href="https://kubernetes.io/docs/concepts/workloads/pods/init-containers/">init-container</a> instead of sidecar container to target workload pods. The init-container takes backup once. If the backup is successfully completed, then it creates a job to perform <code>restic check</code> and exits. The app container starts only after the init-container exits without any error. This ensures that the app container is not running while taking backup.
Stash operator also creates a cron-job that deletes the workload pods according to the <code>spec.schedule</code>. Thus the workload pods get restarted periodically and allow the init-container to take backup.</p>

<pre><code class="language-console">$ kubectl get pods -l app=stash-demo -w
NAME                          READY     STATUS        RESTARTS   AGE
stash-demo-788ffcf9c6-p5kxc   1/1       Terminating   0          1m
stash-demo-7b4f6877dc-nhrz9   0/1       Init:0/1      0          4s
stash-demo-7b4f6877dc-nhrz9   1/1       Running       0          32s
</code></pre>

<pre><code class="language-yaml">$ kubectl get deployment stash-demo -o yaml

apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  annotations:
    deployment.kubernetes.io/revision: &quot;2&quot;
    restic.appscode.com/last-applied-configuration: |
      {&quot;kind&quot;:&quot;Restic&quot;,&quot;apiVersion&quot;:&quot;stash.appscode.com/v1alpha1&quot;,&quot;metadata&quot;:{&quot;name&quot;:&quot;stash-demo&quot;,&quot;namespace&quot;:&quot;default&quot;,&quot;selfLink&quot;:&quot;/apis/stash.appscode.com/v1alpha1/namespaces/default/restics/stash-demo&quot;,&quot;uid&quot;:&quot;c55d5918-d8da-11e7-be92-0800277f19c0&quot;,&quot;resourceVersion&quot;:&quot;57719&quot;,&quot;creationTimestamp&quot;:&quot;2017-12-04T10:06:18Z&quot;},&quot;spec&quot;:{&quot;selector&quot;:{&quot;matchLabels&quot;:{&quot;app&quot;:&quot;stash-demo&quot;}},&quot;fileGroups&quot;:[{&quot;path&quot;:&quot;/source/data&quot;,&quot;retentionPolicyName&quot;:&quot;keep-last-5&quot;}],&quot;backend&quot;:{&quot;storageSecretName&quot;:&quot;stash-demo&quot;,&quot;local&quot;:{&quot;volumeSource&quot;:{&quot;hostPath&quot;:{&quot;path&quot;:&quot;/data/stash-test/restic-repo&quot;}},&quot;path&quot;:&quot;/safe/data&quot;}},&quot;schedule&quot;:&quot;@every 5m&quot;,&quot;volumeMounts&quot;:[{&quot;name&quot;:&quot;source-data&quot;,&quot;mountPath&quot;:&quot;/source/data&quot;}],&quot;resources&quot;:{},&quot;retentionPolicies&quot;:[{&quot;name&quot;:&quot;keep-last-5&quot;,&quot;keepLast&quot;:5,&quot;prune&quot;:true}],&quot;type&quot;:&quot;offline&quot;},&quot;status&quot;:{}}
    restic.appscode.com/tag: canary
  creationTimestamp: 2017-12-04T10:04:11Z
  generation: 2
  labels:
    app: stash-demo
  name: stash-demo
  namespace: default
  resourceVersion: &quot;57824&quot;
  selfLink: /apis/extensions/v1beta1/namespaces/default/deployments/stash-demo
  uid: 798d4e60-d8da-11e7-be92-0800277f19c0
spec:
  progressDeadlineSeconds: 600
  replicas: 1
  revisionHistoryLimit: 2
  selector:
    matchLabels:
      app: stash-demo
  strategy:
    rollingUpdate:
      maxSurge: 25%
      maxUnavailable: 25%
    type: RollingUpdate
  template:
    metadata:
      creationTimestamp: null
      labels:
        app: stash-demo
      name: busybox
    spec:
      containers:
      - command:
        - sleep
        - &quot;3600&quot;
        image: busybox
        imagePullPolicy: IfNotPresent
        name: busybox
        resources: {}
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        volumeMounts:
        - mountPath: /source/data
          name: source-data
      dnsPolicy: ClusterFirst
      initContainers:
      - args:
        - backup
        - --restic-name=stash-demo
        - --workload-kind=Deployment
        - --workload-name=stash-demo
        - --image-tag=canary
        - --enable-rbac=true
        env:
        - name: NODE_NAME
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: spec.nodeName
        - name: POD_NAME
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.name
        image: appscode/stash:0.7.0
        imagePullPolicy: IfNotPresent
        name: stash
        resources: {}
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        volumeMounts:
        - mountPath: /tmp
          name: stash-scratchdir
        - mountPath: /etc/stash
          name: stash-podinfo
        - mountPath: /source/data
          name: source-data
          readOnly: true
        - mountPath: /safe/data
          name: stash-local
      restartPolicy: Always
      schedulerName: default-scheduler
      securityContext: {}
      terminationGracePeriodSeconds: 30
      volumes:
      - gitRepo:
          repository: https://github.com/appscode/stash-data.git
        name: source-data
      - emptyDir: {}
        name: stash-scratchdir
      - downwardAPI:
          defaultMode: 420
          items:
          - fieldRef:
              apiVersion: v1
              fieldPath: metadata.labels
            path: labels
        name: stash-podinfo
      - hostPath:
          path: /data/stash-test/restic-repo
          type: &quot;&quot;
        name: stash-local
status:
  availableReplicas: 1
  conditions:
  - lastTransitionTime: 2017-12-04T10:06:26Z
    lastUpdateTime: 2017-12-04T10:06:26Z
    message: Deployment has minimum availability.
    reason: MinimumReplicasAvailable
    status: &quot;True&quot;
    type: Available
  - lastTransitionTime: 2017-12-04T10:04:11Z
    lastUpdateTime: 2017-12-04T10:06:26Z
    message: ReplicaSet &quot;stash-demo-7b4f6877dc&quot; has successfully progressed.
    reason: NewReplicaSetAvailable
    status: &quot;True&quot;
    type: Progressing
  observedGeneration: 2
  readyReplicas: 1
  replicas: 1
  updatedReplicas: 1
</code></pre>

<p>If everything goes well, A <code>Repository</code> crd with name <code>deployment.stash-demo</code> will be created for the respective repository in the specified backend. Verify that, <code>Repository</code> is created successfully using this command,</p>

<pre><code class="language-console">$ kubectl get repository deployment.stash-demo
NAME                    AGE
deployment.stash-demo   1m
</code></pre>

<p><code>Restic</code> will take backup of the volume periodically with a 1-minute interval. You can verify that backup is taking successfully by,</p>

<pre><code class="language-console">$ kubectl get snapshots -l repository=deployment.stash-demo
NAME                             AGE
deployment.stash-demo-c1014ca6   10s
</code></pre>

<p>Here, <code>deployment.stash-demo-c1014ca6</code> represents the name of the successful backup <a href="/products/stash/0.7.0/concepts/crds/snapshot">Snapshot</a> taken by Stash in <code>deployment.stash-demo</code> repository.</p>

<p>Stash operator also creates a cron job to periodically delete workload pods according to <code>spec.schedule</code>. Please note that Kubernetes cron jobs <a href="https://github.com/kubernetes/kubernetes/issues/47202">do not support timezone</a>.</p>

<pre><code class="language-console">kubectl get cronjob
NAME                            SCHEDULE    SUSPEND   ACTIVE    LAST SCHEDULE   AGE
stash-kubectl-cron-stash-demo   @every 5m   False     0         &lt;none&gt;
</code></pre>

<p>Note that offline backup is not supported for workload kind <code>Deployment</code>, <code>Replicaset</code> and <code>ReplicationController</code> with <code>replicas &gt; 1</code>.</p>

<h2 id="cleaning-up">Cleaning up</h2>

<p>To cleanup the Kubernetes resources created by this tutorial, run:</p>

<pre><code class="language-console">$ kubectl delete deployment stash-demo
$ kubectl delete secret stash-demo
$ kubectl delete restic stash-demo
$ kubectl delete repository deployment.stash-demo
</code></pre>

<p>If you would like to uninstall Stash operator, please follow the steps <a href="/products/stash/0.7.0/setup/uninstall">here</a>.</p>

<h2 id="next-steps">Next Steps</h2>

<ul>
<li>Learn how to use Stash to backup a Kubernetes deployment <a href="/products/stash/0.7.0/guides/backup">here</a>.</li>
<li>Learn about the details of Restic CRD <a href="/products/stash/0.7.0/concepts/crds/restic">here</a>.</li>
<li>To restore a backup see <a href="/products/stash/0.7.0/guides/restore">here</a>.</li>
<li>Learn about the details of Recovery CRD <a href="/products/stash/0.7.0/concepts/crds/recovery">here</a>.</li>
<li>See the list of supported backends and how to configure them <a href="/products/stash/0.7.0/guides/backends">here</a>.</li>
<li>See working examples for supported workload types <a href="/products/stash/0.7.0/guides/workloads">here</a>.</li>
<li>Thinking about monitoring your backup operations? Stash works <a href="/products/stash/0.7.0/guides/monitoring">out-of-the-box with Prometheus</a>.</li>
<li>Learn about how to configure <a href="/products/stash/0.7.0/guides/rbac">RBAC roles</a>.</li>
<li>Want to hack on Stash? Check our <a href="/products/stash/0.7.0/CONTRIBUTING">contribution guidelines</a>.</li>
</ul>

        </div>
      </div>
      <div class="column is-2">
        <div class="right-sidebar-area">
          
          <div class="search-area">
            <form action="#">
              <input id="acSearch" type="text" placeholder="Search..." />
              <button class="search-button">
                <i class="fa fa-search" aria-hidden="true"></i>
              </button>
            </form>
          </div>
          

          
          <div class="tbl-of-contents">
            <h4>What's on this Page</h4>
            <nav id="TableOfContents">
<ul>
<li><a href="#offline-backup">Offline Backup</a>
<ul>
<li><a href="#cleaning-up">Cleaning up</a></li>
<li><a href="#next-steps">Next Steps</a></li>
</ul></li>
</ul>
</nav>
          </div>
          
        </div>
      </div>
    </div>
  </div>
  <script>
    
    var kdDropdown = document.querySelector(".dropdown");
    var kdDropdownBtn = document.querySelector(".dropdown-trigger");
      kdDropdownBtn.addEventListener("click", function(){
        kdDropdown.classList.toggle("is-active");
      })
  </script>
</div>





<div class="overlay-bg"></div>


<div class="sidebar-search-area">
  <div class="search-area-top">
    <h3>Search</h3>

    <div class="searchbar-area">
      <input type="search" name="search" id="" placeholder="Search here" />
      <button><i class="fa fa-search" aria-hidden="true"></i></button>
    </div>

    <div class="search-meta-information level">
      <div class="level-left">
        <p>
          About <span class="search-count">63</span> results (<span
            class="time-count"
            >0.56 </span
          >seconds)
        </p>
      </div>
      <div class="level-right">
        <div class="shorting-data">
          <label for="filter-short">Short by:</label>
          <select name="filter-short" id="filter-short">
            <option value="1">Date</option>
            <option value="2">Time</option>
            <option value="3">Year</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <div class="search-result-wrapper">
    
    <div class="single-search-result">
      <h3><a href="#">PostgreSQL | AppsCode Service Broker</a></h3>
      <a href="#"
        >https://appscode.com/products/service-broker/0.1.0/.../postgres/</a
      >
      <div class="result-description-wrapper">
        <div class="result-thumb">
          <img src="/src/assets/images/search-images/1.png" alt="" />
        </div>
        <div class="result-description">
          <p>
            This tutorial will show you how to use AppsCode Service Broker
            to provision and deprovision an PostgreSQL cluster and bind to
            the PostgreSQL service.
          </p>
        </div>
      </div>
    </div>
    

    
    <div class="single-search-result">
      <h3><a href="#">PostgreSQL | AppsCode Service Broker</a></h3>
      <a href="#"
        >https://appscode.com/products/service-broker/0.1.0/.../postgres/</a
      >
      <div class="result-description-wrapper">
        <div class="result-thumb">
          <img src="/src/assets/images/search-images/2.png" alt="" />
        </div>
        <div class="result-description">
          <p>
            This tutorial will show you how to use AppsCode Service Broker
            to provision and deprovision an PostgreSQL cluster and bind to
            the PostgreSQL service.
          </p>
        </div>
      </div>
    </div>
    

    
    <div class="single-search-result">
      <h3><a href="#">PostgreSQL | AppsCode Service Broker</a></h3>
      <a href="#"
        >https://appscode.com/products/service-broker/0.1.0/.../postgres/</a
      >
      <div class="result-description-wrapper">
        <div class="result-thumb">
          <img src="/src/assets/images/search-images/3.png" alt="" />
        </div>
        <div class="result-description">
          <p>
            This tutorial will show you how to use AppsCode Service Broker
            to provision and deprovision an PostgreSQL cluster and bind to
            the PostgreSQL service.
          </p>
        </div>
      </div>
    </div>
    

    
    <div class="single-search-result">
      <h3><a href="#">PostgreSQL | AppsCode Service Broker</a></h3>
      <a href="#"
        >https://appscode.com/products/service-broker/0.1.0/.../postgres/</a
      >
      <div class="result-description-wrapper">
        <div class="result-thumb">
          <img src="/src/assets/images/search-images/1.png" alt="" />
        </div>
        <div class="result-description">
          <p>
            This tutorial will show you how to use AppsCode Service Broker
            to provision and deprovision an PostgreSQL cluster and bind to
            the PostgreSQL service.
          </p>
        </div>
      </div>
    </div>
    

    
    <div class="single-search-result">
      <h3><a href="#">PostgreSQL | AppsCode Service Broker</a></h3>
      <a href="#"
        >https://appscode.com/products/service-broker/0.1.0/.../postgres/</a
      >
      <div class="result-description-wrapper">
        <div class="result-thumb">
          <img src="/src/assets/images/search-images/2.png" alt="" />
        </div>
        <div class="result-description">
          <p>
            This tutorial will show you how to use AppsCode Service Broker
            to provision and deprovision an PostgreSQL cluster and bind to
            the PostgreSQL service.
          </p>
        </div>
      </div>
    </div>
    

    
    <div class="single-search-result">
      <h3><a href="#">PostgreSQL | AppsCode Service Broker</a></h3>
      <a href="#"
        >https://appscode.com/products/service-broker/0.1.0/.../postgres/</a
      >
      <div class="result-description-wrapper">
        <div class="result-thumb">
          <img src="/src/assets/images/search-images/3.png" alt="" />
        </div>
        <div class="result-description">
          <p>
            This tutorial will show you how to use AppsCode Service Broker
            to provision and deprovision an PostgreSQL cluster and bind to
            the PostgreSQL service.
          </p>
        </div>
      </div>
    </div>
    

    
    <div class="single-search-result">
      <h3><a href="#">PostgreSQL | AppsCode Service Broker</a></h3>
      <a href="#"
        >https://appscode.com/products/service-broker/0.1.0/.../postgres/</a
      >
      <div class="result-description-wrapper">
        <div class="result-thumb">
          <img src="/src/assets/images/db-logo/sql.png" alt="" />
        </div>
        <div class="result-description">
          <p>
            This tutorial will show you how to use AppsCode Service Broker
            to provision and deprovision an PostgreSQL cluster and bind to
            the PostgreSQL service.
          </p>
        </div>
      </div>
    </div>
    

    
    <div class="single-search-result">
      <h3><a href="#">PostgreSQL | AppsCode Service Broker</a></h3>
      <a href="#"
        >https://appscode.com/products/service-broker/0.1.0/.../postgres/</a
      >
      <div class="result-description-wrapper">
        <div class="result-thumb">
          <img src="/src/assets/images/search-images/1.png" alt="" />
        </div>
        <div class="result-description">
          <p>
            This tutorial will show you how to use AppsCode Service Broker
            to provision and deprovision an PostgreSQL cluster and bind to
            the PostgreSQL service.
          </p>
        </div>
      </div>
    </div>
    
  </div>

  
  <div class="pagination-area">
    <div class="pagination-list">
      <ul>
        <li><a href="#">Previous</a></li>
        <li><a class="is-active" href="#">1</a></li>
        <li><a href="#">2</a></li>
        <li><a href="#">3</a></li>
        <li><a href="#">4</a></li>
        <li><a href="#">...</a></li>
        <li><a href="#">10</a></li>
        <li><a href="#">11</a></li>
        <li><a href="#">Next</a></li>
      </ul>
    </div>
  </div>
  
</div>

<script type="text/javascript">
  var acSearch = document.querySelector("#acSearch");
  var bodyOverlay = document.querySelector(".overlay-bg");
  var sidebarSearch = document.querySelector(".sidebar-search-area");

  acSearch.addEventListener("click", function() {
    bodyOverlay.style.display = "block";
    sidebarSearch.style.right = "0";
    bodyOverlay.addEventListener("click", function() {
      bodyOverlay.style.display = "none";
      sidebarSearch.style.right = "-50%";
    });
  });
</script>




    
    
<section></section>

    

    
    
<section></section>

    

    
    
<section></section>

    

    
    
    <footer class="footer-area">
      <div class="footer-top">
        <div class="container section">
          <div class="columns">
            <div class="column is-4">
              <div class="single-footer-widget">
                
                <div class="footer-logo">
                  <a href="https://appscode-v3-hugo.web.app"
                    ><img
                      src="/assets/images/logo-color-appscode.png"
                      alt=""
                      class="img"
                  /></a>
                </div>
                

                

                
                <div class="modal-div">
                  
                  <div class="subscription-form modal-button">
                    <a class="button kd-primary">
                      Subscribe Our Newsletter
                      <i class="fa fa-paper-plane-o" aria-hidden="true"></i>
                    </a>
                  </div>
                   

                  
                  <div class="modal">
                      <div class="modal-background"></div>
                      <div class="modal-card">
                        <header class="modal-card-head">
                          <p class="modal-card-title">Modal title</p>
                          <button class="delete modal-cancel" aria-label="close"></button>
                        </header>
                        <section class="modal-card-body">
                          
                        </section>
                        <footer class="modal-card-foot">
                          <button class="button kd-primary">Save changes</button>
                          <button class="button modal-cancel">Cancel</button>
                        </footer>
                      </div>
                    </div>
                  
                </div>
                
                <script type="text/javascript">
                  
                  var modalButtons = document.querySelectorAll(".modal-button");
                  var modalCloseBtns = document.querySelectorAll(".mod-close");
                  var modalCancelBtns = document.querySelectorAll(".modal-cancel");
                  var modal = document.querySelector(".modal");

                  
                  modalButtons.forEach(button => {
                    button.addEventListener("click", function(e) {
                      modal.classList.remove("is-active");
                      e.currentTarget.parentNode.querySelectorAll(".modal").forEach(m => {
                        m.classList.add("is-active");
                      });
                    });
                  });

                  modalCloseBtns.forEach(mcb => {
                    mcb.addEventListener("click", function(e) {
                      e.currentTarget.parentNode.parentNode.parentNode.classList.remove(
                        "is-active"
                      );
                    });
                  });

                  modalCancelBtns.forEach(mcb => {
                    mcb.addEventListener("click", function(e) {
                      e.currentTarget.parentNode.parentNode.parentNode.classList.remove(
                        "is-active"
                      );
                    });
                  });
                  
                </script>

                

                
                <div class="contact-information">
                  <h4>Have any Inquiry?</h4>
                  <ul class="all-contact-info">
                    <li>
                      <a href="callto:+123456789"
                        ><span
                          ><i class="fa fa-phone" aria-hidden="true"></i></span
                        >+123 456 789</a
                      >
                    </li>

                    <li>
                      <a href="mailto:appscode@gmail.com"
                        ><span
                          ><i
                            class="fa fa-envelope-o"
                            aria-hidden="true"
                          ></i></span
                        >appscode@gmail.com</a
                      >
                    </li>
                  </ul>
                </div>
                
              </div>
            </div>

            <div class="column is-2">
              <div class="single-footer-widget">
                
                <div class="footer-menu">
                  <h4>Products</h4>
                  <ul class="footer-link">
                    <li><a href="#">Voyager</a></li>
                    <li><a href="#">KubeDB</a></li>
                    <li><a href="#">Pharmer Stash </a></li>
                    <li><a href="#">Service Broker</a></li>
                    <li><a href="#">Kubed</a></li>
                    <li><a href="#">Guard</a></li>
                    <li><a href="#">Swift</a></li>
                    <li><a href="#">Searchlight</a></li>
                  </ul>
                </div>
                
              </div>
            </div>

            <div class="column is-2">
              <div class="single-footer-widget">
                
                <div class="footer-menu">
                  <h4>Offerings</h4>
                  <ul class="footer-link">
                    <li><a href="#">Products</a></li>
                    <li><a href="#">Services</a></li>
                    <li><a href="#">Open source </a></li>
                  </ul>
                </div>
                
              </div>
            </div>

            <div class="column is-2">
              <div class="single-footer-widget">
                
                <div class="footer-menu">
                  <h4>Company</h4>
                  <ul class="footer-link">
                    <li><a href="#">About Us</a></li>
                    <li><a href="#">blog</a></li>
                    <li><a href="#">Seles Inquiry</a></li>
                    <li><a href="#">Contact Us</a></li>
                  </ul>
                </div>
                
              </div>
            </div>

            <div class="column is-2">
              <div class="single-footer-widget">
                
                <div class="footer-menu">
                  <h4>Legal</h4>
                  <ul class="footer-link">
                    <li><a href="#">Service Level Agreement</a></li>
                    <li><a href="#">Security</a></li>
                    <li><a href="#">Learn More</a></li>
                    <li><a href="#">Contact Us</a></li>
                  </ul>
                </div>
                
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="footer-bottom">
        <div class="container section">
          <div class="columns">
            <div class="column is-4">
              <p>All rights reserved © 2018. Appscode, Inc..</p>
            </div>
            <div class="column is-4 is-mobile has-text-centered">
              <div class="footer-inline-link">
                <a href="#">Privacy Policy</a>
                <a href="#">Terms of Service</a>
              </div>
            </div>
            <div class="column is-4 is-mobile has-text-right">
              <div class="socail-link-inline">
                <ul>
                  <li>
                    <a href="#"
                      ><i class="fa fa-twitter" aria-hidden="true"></i
                    ></a>
                  </li>
                  <li>
                    <a href="#"
                      ><i class="fa fa-facebook" aria-hidden="true"></i
                    ></a>
                  </li>
                  <li>
                    <a href="#"
                      ><i class="fa fa-github" aria-hidden="true"></i
                    ></a>
                  </li>
                  <li>
                    <a href="#"
                      ><i class="fa fa-youtube" aria-hidden="true"></i
                    ></a>
                  </li>
                  <li>
                    <a href="#"
                      ><i class="fa fa-twitter" aria-hidden="true"></i
                    ></a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </footer>
    
    

    
    <script src="/assets/js/bulma-carousel.min.js"></script>
    
    <script src="/assets/js/main.js"></script>
  </body>
</html>
