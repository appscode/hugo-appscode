

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <meta name="theme-color" content="#2D9AED" />
    
    <title>Stash Home</title>
    
    
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
    
    <link rel="stylesheet" href="/assets/css/font-awesome.min.css" />
    
    <link rel="stylesheet" href="/assets/css/bulma-carousel.min.css" />
    
    <link rel="stylesheet" href="/assets/css/bulma.min.css" />
    
    <link rel="stylesheet" href="/assets/sass/main.css" />
  </head>

  <body class="stash">
    

    
    
    <header>
      
      
      <div class="header-top">
        <div class="container section">
          <nav class="navbar">
            <div class="navbar-brand">
              <a class="navbar-item" href="https://appscode-v3-hugo.web.app">
                <img src="/assets/images/logo-color-appscode.png" alt="" />
              </a>

              <a
                role="button"
                class="navbar-burger burger"
                aria-label="menu"
                aria-expanded="false"
                data-target="acNav1"
              >
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
              </a>
            </div>

            <div id="acNav1" class="navbar-menu main-menu">
              <div class="navbar-end">
                
                <div class="navbar-start">
                  <div class="navbar-item has-dropdown ac-is-hoverable">
                    <a class="navbar-link">
                      Products
                    </a>

                    
                    <div class="ac-megamenu">
                      <div class="columns">
                        <div class="column is-8">
                          <div class="columns">
                            <div class="column is-6 br-1">
                              
                              <a
                                href="https://appscode-v3-hugo.web.app/products/voyager/"
                                class="single-product-item is-voyager"
                              >
                                <div class="menu-header">
                                  <div class="menu-logo">
                                    <img
                                      src="/assets/images/product-logos/small-size/voyager.png"
                                      alt=""
                                    />
                                  </div>
                                  <h5>Voyager</h5>
                                </div>
                                <div class="menu-body">
                                  <p>
                                    Secure HAProxy Ingress Controller for
                                    Kubernetes
                                  </p>
                                </div>
                              </a>
                              
                              
                              <a
                                href="https://kubedb-v2-hugo.web.app"
                                class="single-product-item is-kubedb"
                              >
                                <div class="menu-header">
                                  <div class="menu-logo">
                                    <img
                                      src="/assets/images/product-logos/small-size/kubedb.png"
                                      alt=""
                                    />
                                  </div>
                                  <h5>KubeDB</h5>
                                </div>
                                <div class="menu-body">
                                  <p>
                                    Run production-grade databases easily on
                                    Kubernetes
                                  </p>
                                </div>
                              </a>
                              
                              
                              <a
                                href="https://appscode-v3-hugo.web.app/products/stash/"
                                class="single-product-item is-stash"
                              >
                                <div class="menu-header">
                                  <div class="menu-logo">
                                    <img
                                      src="/assets/images/product-logos/small-size/stash.png"
                                      alt=""
                                    />
                                  </div>
                                  <h5>Stash</h5>
                                </div>
                                <div class="menu-body">
                                  <p>
                                    Backup your Kubernetes Stateful Applications
                                  </p>
                                </div>
                              </a>
                              
                              
                              <a
                                href="https://appscode-v3-hugo.web.app/products/guard/"
                                class="single-product-item is-guard"
                              >
                                <div class="menu-header">
                                  <div class="menu-logo">
                                    <img
                                      src="/assets/images/product-logos/small-size/guard.png"
                                      alt=""
                                    />
                                  </div>
                                  <h5>Guard</h5>
                                </div>
                                <div class="menu-body">
                                  <p>
                                    Kubernetes Authentication WebHook Server
                                  </p>
                                </div>
                              </a>
                              
                              
                              <a
                                href="https://kubeci-v1-hugo.web.app"
                                class="single-product-item is-kubeci"
                              >
                                <div class="menu-header">
                                  <div class="menu-logo">
                                    <img
                                      src="/assets/images/product-logos/small-size/appscode.png"
                                      alt=""
                                    />
                                  </div>
                                  <h5>KubeCI</h5>
                                </div>
                                <div class="menu-body">
                                  <p>
                                    Kubernetes native CI
                                  </p>
                                </div>
                              </a>
                              
                            </div>
                            <div class="column is-6 br-1">
                              
                              <a
                                href="https://appscode-v3-hugo.web.app/products/searchlight/"
                                class="single-product-item is-searchlight"
                              >
                                <div class="menu-header">
                                  <div class="menu-logo">
                                    <img
                                      src="/assets/images/product-logos/small-size/searchlight.png"
                                      alt=""
                                    />
                                  </div>
                                  <h5>Searchlight</h5>
                                </div>
                                <div class="menu-body">
                                  <p>
                                    Alerts for Kubernetes
                                  </p>
                                </div>
                              </a>
                              
                              
                              <a
                                href="https://appscode-v3-hugo.web.app/products/swift/"
                                class="single-product-item is-swift"
                              >
                                <div class="menu-header">
                                  <div class="menu-logo">
                                    <img
                                      src="/assets/images/product-logos/small-size/appscode.png"
                                      alt=""
                                    />
                                  </div>
                                  <h5>Swift</h5>
                                </div>
                                <div class="menu-body">
                                  <p>
                                    Ajax friendly Helm Tiller Proxy
                                  </p>
                                </div>
                              </a>
                              
                              
                              <a
                                href="https://appscode-v3-hugo.web.app/products/service-broker/"
                                class="single-product-item is-broker"
                              >
                                <div class="menu-header">
                                  <div class="menu-logo">
                                    <img
                                      src="/assets/images/product-logos/small-size/service-broke.png"
                                      alt=""
                                    />
                                  </div>
                                  <h5>Service Broker</h5>
                                </div>
                                <div class="menu-body">
                                  <p>
                                    Open Service Broker for AppsCode Cloud
                                    Services
                                  </p>
                                </div>
                              </a>
                              
                              
                              <a
                                href="https://appscode-v3-hugo.web.app/products/pharmer/"
                                class="single-product-item is-pharmer"
                              >
                                <div class="menu-header">
                                  <div class="menu-logo">
                                    <img
                                      src="/assets/images/product-logos/small-size/phamer.png"
                                      alt=""
                                    />
                                  </div>
                                  <h5>Pharmer</h5>
                                </div>
                                <div class="menu-body">
                                  <p>
                                    Kubernetes Cluster Manager using Kubeadm &
                                    Cluster API
                                  </p>
                                </div>
                              </a>
                              
                              
                              <a
                                href="https://kubeshield-v1-hugo.web.app"
                                class="single-product-item is-kubeshield"
                              >
                                <div class="menu-header">
                                  <div class="menu-logo">
                                    <img
                                      src="/assets/images/product-logos/small-size/kubeshild.png"
                                      alt=""
                                    />
                                  </div>
                                  <h5>KubeShield</h5>
                                </div>
                                <div class="menu-body">
                                  <p>
                                    Secure Kubernetes
                                  </p>
                                </div>
                              </a>
                              
                            </div>
                          </div>
                        </div>
                        <div class="column is-4">
                          <div class="columns">
                            <div class="column is-12">
                              
                              <a
                                href="https://byte.builders"
                                class="single-product-item byte-builder kd-orange"
                              >
                                <div class="menu-header">
                                  <p class="intro">Introducing....</p>
                                  <h5>Byte.builders</h5>
                                </div>
                                <div class="menu-body">
                                  <p>
                                    The Kubernetes Cloud
                                  </p>
                                </div>
                                <p class="learn-more-btn">
                                  Learn more
                                  <span class="icon"
                                    ><i
                                      class="fa fa-long-arrow-right"
                                      aria-hidden="true"
                                    ></i
                                  ></span>
                                </p>
                              </a>
                              

                              
                              <a
                                href="https://appscode-v3-hugo.web.app/products/kubed/"
                                class="single-product-item is-kubed"
                              >
                                <div class="menu-header">
                                  <div class="menu-logo">
                                    <img
                                      src="/assets/images/product-logos/small-size/kubed.png"
                                      alt=""
                                    />
                                  </div>
                                  <h5>Kubed</h5>
                                </div>
                                <div class="menu-body">
                                  <p>
                                    A Kubernetes cluster manager daemon
                                  </p>
                                </div>
                              </a>
                              
                              
                              <a
                                href="https://kubevault-v1-hugo.web.app"
                                class="single-product-item is-kubevault"
                              >
                                <div class="menu-header">
                                  <div class="menu-logo">
                                    <img
                                      src="/assets/images/product-logos/small-size/kube-vault.png"
                                      alt=""
                                    />
                                  </div>
                                  <h5>KubeVault</h5>
                                </div>
                                <div class="menu-body">
                                  <p>
                                    Tools for running HashiCorp Vault on
                                    Kubernetes
                                  </p>
                                </div>
                              </a>
                              
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="columns has-text-centered">
                        <div class="column">
                          <div class="menu-bottom">
                            <p>
                              Explore refreshing apps and integrations for
                              AppsCode products:
                              <a href="https://marketplace.byte.builders">
                                Visit the Marketplace
                                <i
                                  class="fa fa-long-arrow-right"
                                  aria-hidden="true"
                                ></i
                              ></a>
                            </p>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                  </div>

                  <a class="navbar-item">
                    Services
                  </a>
                  <a class="navbar-item">
                    Open Source
                  </a>
                  <a class="navbar-item">
                    Blog
                  </a>
                  <a class="navbar-item">
                    Contact
                  </a>
                </div>
                
                <div class="navbar-item">
                  <div class="buttons main-menu-button-top">
                    <a class="button is-small for-support">
                      <span
                        ><img
                          src="/assets/images/icon/chat.png"
                          alt=""/></span
                      >Forum
                    </a>
                    <a class="button is-small for-chat">
                      <span
                        ><img
                          src="/assets/images/icon/slack.png"
                          alt=""/></span
                      >Chat
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </nav>
        </div>
      </div>
      
      

      

      

      
      <div
        class="header-bottom-area header-area kubedb-primary-bg customize-kubedb"
        id="header"
      >
        <div class="container section">
          <nav class="navbar">
            <div class="navbar-brand">
              
                <a class="navbar-item" href="https://appscode-v3-hugo.web.app/products/stash">
                  <img src="/assets/images/product-logos/stash-white.png" alt="" />
                </a>
              

              <a
                role="button"
                class="navbar-burger burger"
                aria-label="menu"
                aria-expanded="false"
                data-target="acNav"
              >
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
              </a>
            </div>

            <div id="acNav" class="navbar-menu main-menu">
              <div class="navbar-end">
                
                  
                    
                    <div class="navbar-start">
                    
                    
                      
                        
                          <a href="/products/stash/features/" class="navbar-item">Features</a>
                        
                      
                    
                      
                        
                          <a href="/products/stash/pricing/" class="navbar-item">Commercial Support</a>
                        
                      
                    
                      
                        
                          <a href="/products/stash/v0.9.0-rc.0/welcome/">Documentation</a>
                        
                      
                    
                      
                        <div class="navbar-item has-dropdown ac-is-hoverable">
                          <a class="navbar-link">Community</a>
                          <div class="ac-dropdown">
                            
                              
                                <a href="https://github.com/kubedb" class="navbar-item">GitHub</a>
                              
                            
                              
                                <a href="https://twitter.com/KubeDB" class="navbar-item">Twitter</a>
                              
                            
                              
                                <a href="https://groups.google.com/forum/#!forum/kubedb" class="navbar-item">Groups</a>
                              
                            
                              
                                <a href="http://slack.kubernetes.io/" class="navbar-item">Slack</a>
                              
                            
                              
                                <a href="http://discourse.appscode.com" class="navbar-item">Forum</a>
                              
                            
                          </div>
                        </div>
                      
                    
                    </div>
                    

                    
                    <div class="navbar-item">
                      <div class="buttons main-menu-button">
                        
                        <a
                          class="github-button"
                          href="https://github.com/stashed/stash"
                          data-size="large"
                          data-show-count="true"
                          aria-label="Star stashed/stash on GitHub"
                        >Star</a>
                        
                        <script async defer src="https://buttons.github.io/buttons.js"></script>
                      </div>
                    </div>
                  
                
              </div>
            </div>
          </nav>
        </div>
      </div>
      
      

      




<div class="kubedb-documentation-menu">
  <div class="container section">
    
    <div class="documentation-menu">
      <div class="container section">
        <div class="columns is-centered">
          <div class="column is-half has-text-centered">
            
            <div class="responsive-menu">
              <a
                role="button"
                class="navbar-burger burger"
                aria-label="menu"
                aria-expanded="false"
                data-target="acNav3"
              >
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
              </a>
            </div>
            
            
            <nav class="documentation-navbar">
              <div id="acNav3" class="navbar-menu nav-menu main-menu">
                <div class="navbar-centered">
                  
                  <div class="navbar-start">
                    
                    
                      
                        
                          <a href="/products/stash/v0.9.0-rc.0/" class=" navbar-item">Welcome</a>
                        
                      
                        
                          <a href="/products/stash/v0.9.0-rc.0/concepts/" class=" navbar-item">Concepts</a>
                        
                      
                        
                          <a href="/products/stash/v0.9.0-rc.0/setup/" class=" navbar-item">Setup</a>
                        
                      
                        
                          <div class="navbar-item has-dropdown ac-is-hoverable">
                            <a class="navbar-link">
                              Guides
                            </a>
                            <div class="ac-dropdown">
                              
                                
                                  <a href="/products/stash/v0.9.0-rc.0/guides/latest/" class="navbar-item">Latest Guides</a>
                                
                              
                                
                                  <a href="/products/stash/v0.9.0-rc.0/guides/v1alpha1/" class="navbar-item">v1alpha1 Guides</a>
                                
                              
                            </div>
                          </div>
                        
                      
                        
                          <div class="navbar-item has-dropdown ac-is-hoverable">
                            <a class="navbar-link">
                              Reference
                            </a>
                            <div class="ac-dropdown">
                              
                                
                                  <a href="/products/stash/v0.9.0-rc.0/reference/operator/" class="navbar-item">Stash Operator</a>
                                
                              
                            </div>
                          </div>
                        
                      
                    
                  </div>
                  
                </div>
              </div>
            </nav>
            
          </div>
        </div>
      </div>
    </div>
    
  </div>
</div>


    </header>
    
    

    
    









<div class="documentation-area">
  <div class="container section">
    <div class="columns">
      <div class="column is-3">
        
        <div class="kd-left-sidebar">
          
            
            
            
            

            <div class="trial-button">
              <a href="/products/stash/v0.9.0-rc.0/setup/" class="button is-fullwidth">
                Try Now for FREE!
              </a>
            </div>

            <div class="kd-version">
              <div class="dropdown">
                <div class="dropdown-trigger">
                  <button
                    class="button is-fullwidth"
                    aria-haspopup="true"
                    aria-controls="dropdown-menu3"
                  >

                    
                      
                      
                        
                      
                    
                      
                      
                        
                          <span><strong class="icon"><i class="fa fa-cog" aria-hidden="true"></i></strong>v0.9.0-rc.0</span>
                        
                          <span class="new-item">Latest</span>
                        
                        
                      
                    
                      
                      
                        
                      
                    
                      
                      
                        
                      
                    
                      
                      
                        
                      
                    
                      
                      
                        
                      
                    
                      
                      
                        
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                        
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                        
                      
                    

                    <span class="icon is-small">
                      <i class="fa fa-angle-down" aria-hidden="true"></i>
                    </span>
                  </button>
                </div>
                <div class="dropdown-menu" id="dropdown-menu3" role="menu">
                  <div class="dropdown-content">
                    
                      
                      
                        
                          <a href="https://github.com/stashed/docs/tree/master/docs" target="_blank" class="dropdown-item">master</a>
                        
                      
                    
                      
                      
                        
                          <a href="/products/stash/v0.9.0-rc.0/" class="dropdown-item">v0.9.0-rc.0   <div class="tag">Latest</div> </a>
                        
                      
                    
                      
                      
                        
                          <a href="/products/stash/0.8.3/" class="dropdown-item">0.8.3  </a>
                        
                      
                    
                      
                      
                        
                          <a href="/products/stash/0.8.2/" class="dropdown-item">0.8.2  </a>
                        
                      
                    
                      
                      
                        
                          <a href="/products/stash/0.8.1/" class="dropdown-item">0.8.1  </a>
                        
                      
                    
                      
                      
                        
                          <a href="/products/stash/0.8.0/" class="dropdown-item">0.8.0  </a>
                        
                      
                    
                      
                      
                        
                          <a href="/products/stash/0.7.0/" class="dropdown-item">0.7.0  </a>
                        
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                        
                          <a href="/products/stash/0.6.4/" class="dropdown-item">0.6.4  </a>
                        
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                        
                          <a href="https://github.com/stashed/docs/tree/0.4.2/docs" target="_blank" class="dropdown-item">0.4.2</a>
                        
                      
                    
                  </div>
                </div>
              </div>

            </div>
          

          
            
            
              
            
              
            
              
            
              
                
                  

                  
                  
                    

                      

                    
                  
                    
                  
                
              
            
              
            
          

          
          <div class="kd-sidebar-menu">
            
              

              
              

                
              

                
              

                
              

                
                  

                  
                  

                    
                      
                        

                            
                              
                                




  



<div class="item">
  <input type="checkbox" id="2fc7ca5b79f6c236ba66a4893029fe67-1" >
  <label for="2fc7ca5b79f6c236ba66a4893029fe67-1"><a href="/products/stash/v0.9.0-rc.0/guides/latest/">Latest Guides</a></label>
</div>


                              
                            
                              
                                






<div class="item">
  <input type="checkbox" id="2fc7ca5b79f6c236ba66a4893029fe67-2" >
  <label for="2fc7ca5b79f6c236ba66a4893029fe67-2"><a>Supported Backends</a> <span><i class="fa fa-angle-right"
              aria-hidden="true"></i></span></label>
  <div class="item">
    <ul>
      
        
          <li ><a href="/products/stash/v0.9.0-rc.0/guides/latest/backends/overview/">What is Backend?</a></li>
        
      
        
          <li ><a href="/products/stash/v0.9.0-rc.0/guides/latest/backends/local/">Kubernetes Volumes</a></li>
        
      
        
          <li ><a href="/products/stash/v0.9.0-rc.0/guides/latest/backends/s3/">AWS S3/Minio/Rook</a></li>
        
      
        
          <li ><a href="/products/stash/v0.9.0-rc.0/guides/latest/backends/azure/">Azure Blob Storage</a></li>
        
      
        
          <li ><a href="/products/stash/v0.9.0-rc.0/guides/latest/backends/gcs/">Google Cloud Storage</a></li>
        
      
        
          <li ><a href="/products/stash/v0.9.0-rc.0/guides/latest/backends/swift/">OpenStack Swift</a></li>
        
      
        
          <li ><a href="/products/stash/v0.9.0-rc.0/guides/latest/backends/b2/">Backblaze B2</a></li>
        
      
        
          <li ><a href="/products/stash/v0.9.0-rc.0/guides/latest/backends/rest/">REST Server</a></li>
        
      
    </ul>
  </div>
</div>


                              
                            
                              
                                






<div class="item">
  <input type="checkbox" id="2fc7ca5b79f6c236ba66a4893029fe67-3" >
  <label for="2fc7ca5b79f6c236ba66a4893029fe67-3"><a>Workload&#39;s Volumes</a> <span><i class="fa fa-angle-right"
              aria-hidden="true"></i></span></label>
  <div class="item">
    <ul>
      
        
          <li ><a href="/products/stash/v0.9.0-rc.0/guides/latest/workloads/overview/">How Backup and Restore works?</a></li>
        
      
        
          <li ><a href="/products/stash/v0.9.0-rc.0/guides/latest/workloads/deployment/">Backup &amp; Restore Volumes of a Deployment</a></li>
        
      
        
          <li ><a href="/products/stash/v0.9.0-rc.0/guides/latest/workloads/statefulset/">Backup &amp; Restore Volumes of a StatefulSet</a></li>
        
      
        
          <li ><a href="/products/stash/v0.9.0-rc.0/guides/latest/workloads/daemonset/">Backup &amp; Restore Volumes of a DaemonSet</a></li>
        
      
    </ul>
  </div>
</div>


                              
                            
                              
                                






<div class="item">
  <input type="checkbox" id="2fc7ca5b79f6c236ba66a4893029fe67-4" >
  <label for="2fc7ca5b79f6c236ba66a4893029fe67-4"><a>Stand-alone Volumes</a> <span><i class="fa fa-angle-right"
              aria-hidden="true"></i></span></label>
  <div class="item">
    <ul>
      
        
          <li ><a href="/products/stash/v0.9.0-rc.0/guides/latest/volumes/overview/">How does it work?</a></li>
        
      
        
          <li ><a href="/products/stash/v0.9.0-rc.0/guides/latest/volumes/pvc/">Backup &amp; Restore a Stand-alone PVC</a></li>
        
      
    </ul>
  </div>
</div>


                              
                            
                              
                                






<div class="item">
  <input type="checkbox" id="2fc7ca5b79f6c236ba66a4893029fe67-5" >
  <label for="2fc7ca5b79f6c236ba66a4893029fe67-5"><a>Databases</a> <span><i class="fa fa-angle-right"
              aria-hidden="true"></i></span></label>
  <div class="item">
    <ul>
      
        
          <li ><a href="/products/stash/v0.9.0-rc.0/guides/latest/databases/overview/">How does it work?</a></li>
        
      
    </ul>
  </div>
</div>


                              
                            
                              
                                






<div class="item">
  <input type="checkbox" id="2fc7ca5b79f6c236ba66a4893029fe67-6" checked>
  <label for="2fc7ca5b79f6c236ba66a4893029fe67-6"><a>Auto Backup</a> <span><i class="fa fa-angle-right"
              aria-hidden="true"></i></span></label>
  <div class="item">
    <ul>
      
        
          <li ><a href="/products/stash/v0.9.0-rc.0/guides/latest/auto-backup/overview/">What is Auto Backup?</a></li>
        
      
        
          <li class="is-active"><a href="/products/stash/v0.9.0-rc.0/guides/latest/auto-backup/workload/">Auto Backup for Workloads</a></li>
        
      
        
          <li ><a href="/products/stash/v0.9.0-rc.0/guides/latest/auto-backup/pvc/">Auto Backup for PVCs</a></li>
        
      
        
          <li ><a href="/products/stash/v0.9.0-rc.0/guides/latest/auto-backup/database/">Auto Backup for Databases</a></li>
        
      
    </ul>
  </div>
</div>


                              
                            
                              
                                






<div class="item">
  <input type="checkbox" id="2fc7ca5b79f6c236ba66a4893029fe67-7" >
  <label for="2fc7ca5b79f6c236ba66a4893029fe67-7"><a>Volume Snapshot</a> <span><i class="fa fa-angle-right"
              aria-hidden="true"></i></span></label>
  <div class="item">
    <ul>
      
        
          <li ><a href="/products/stash/v0.9.0-rc.0/guides/latest/volumesnapshot/overview/">How VolumeSnapshot works?</a></li>
        
      
        
          <li ><a href="/products/stash/v0.9.0-rc.0/guides/latest/volumesnapshot/deployment/">Snapshot Deployment Volumes</a></li>
        
      
        
          <li ><a href="/products/stash/v0.9.0-rc.0/guides/latest/volumesnapshot/statefulset/">Snapshot StatefulSet Volumes</a></li>
        
      
        
          <li ><a href="/products/stash/v0.9.0-rc.0/guides/latest/volumesnapshot/pvc/">Snapshot Stand-alone PVC</a></li>
        
      
    </ul>
  </div>
</div>


                              
                            
                              
                                






<div class="item">
  <input type="checkbox" id="2fc7ca5b79f6c236ba66a4893029fe67-8" >
  <label for="2fc7ca5b79f6c236ba66a4893029fe67-8"><a>Advance Use Cases</a> <span><i class="fa fa-angle-right"
              aria-hidden="true"></i></span></label>
  <div class="item">
    <ul>
      
        
          <li ><a href="/products/stash/v0.9.0-rc.0/guides/latest/advanced-use-case/instant-backup/">Instant Backup</a></li>
        
      
        
          <li ><a href="/products/stash/v0.9.0-rc.0/guides/latest/advanced-use-case/pause-backup/">Pause Backup</a></li>
        
      
        
          <li ><a href="/products/stash/v0.9.0-rc.0/guides/latest/advanced-use-case/clone-pvc/">Clone Data Volumes</a></li>
        
      
        
          <li ><a href="/products/stash/v0.9.0-rc.0/guides/latest/advanced-use-case/ownership/">File Ownership</a></li>
        
      
    </ul>
  </div>
</div>


                              
                            
                              
                                






<div class="item">
  <input type="checkbox" id="2fc7ca5b79f6c236ba66a4893029fe67-9" >
  <label for="2fc7ca5b79f6c236ba66a4893029fe67-9"><a>Platforms</a> <span><i class="fa fa-angle-right"
              aria-hidden="true"></i></span></label>
  <div class="item">
    <ul>
      
        
          <li ><a href="/products/stash/v0.9.0-rc.0/guides/latest/platforms/eks/">EKS</a></li>
        
      
        
          <li ><a href="/products/stash/v0.9.0-rc.0/guides/latest/platforms/aks/">AKS</a></li>
        
      
        
          <li ><a href="/products/stash/v0.9.0-rc.0/guides/latest/platforms/gke/">GKE</a></li>
        
      
        
          <li ><a href="/products/stash/v0.9.0-rc.0/guides/latest/platforms/minio/">Minio</a></li>
        
      
        
          <li ><a href="/products/stash/v0.9.0-rc.0/guides/latest/platforms/rook/">Rook</a></li>
        
      
    </ul>
  </div>
</div>


                              
                            
                              
                                






<div class="item">
  <input type="checkbox" id="2fc7ca5b79f6c236ba66a4893029fe67-10" >
  <label for="2fc7ca5b79f6c236ba66a4893029fe67-10"><a>Monitoring</a> <span><i class="fa fa-angle-right"
              aria-hidden="true"></i></span></label>
  <div class="item">
    <ul>
      
        
          <li ><a href="/products/stash/v0.9.0-rc.0/guides/latest/monitoring/overview/">Overview</a></li>
        
      
        
          <li ><a href="/products/stash/v0.9.0-rc.0/guides/latest/monitoring/builtin/">Builtin Prometheus</a></li>
        
      
        
          <li ><a href="/products/stash/v0.9.0-rc.0/guides/latest/monitoring/coreos/">Prometheus Operator</a></li>
        
      
    </ul>
  </div>
</div>


                              
                            

                        
                      

                    
                    
                  

                    
                      
                        
                      

                    
                    
                  
                  

                
              

                
              
              
            
          </div>
          
        </div>
        
      </div>
      <div class="column is-7">
        <div class="full-info">
          

<h1 id="auto-backup-for-workloads">Auto Backup for Workloads</h1>

<p>This tutorial will show you how to configure automatic backup for Kubernetes workloads. Here, we are going to show a demo on how we can backup Deployments, StatefulSets, and DaemonSets using a common blueprint.</p>

<h2 id="before-you-begin">Before You Begin</h2>

<ul>
<li><p>At first, you need to have a Kubernetes cluster, and the <code>kubectl</code> command-line tool must be configured to communicate with your cluster. If you do not already have a cluster, you can create one using <a href="https://github.com/kubernetes/minikube">Minikube</a>.</p></li>

<li><p>Install <code>Stash</code> in your cluster following the steps <a href="/products/stash/v0.9.0-rc.0/setup/install">here</a>.</p></li>

<li><p>You should be familiar with the following Stash concepts:</p>

<ul>
<li><a href="/products/stash/v0.9.0-rc.0/concepts/crds/repository">Repository</a></li>
<li><a href="/products/stash/v0.9.0-rc.0/concepts/crds/backupconfiguration">BackupConfiguration</a></li>
<li><a href="/products/stash/v0.9.0-rc.0/concepts/crds/backupblueprint">BackupBlueprint</a></li>
<li><a href="/products/stash/v0.9.0-rc.0/concepts/crds/backupsession">BackupSession</a></li>
</ul></li>
</ul>

<p>To keep things isolated, we are going to use a separate namespace called <code>demo</code> throughout this tutorial.</p>

<pre><code class="language-console">$ kubectl create namespace demo
namespace/demo created
</code></pre>

<h2 id="prepare-backup-blueprint">Prepare Backup Blueprint</h2>

<p>We are going to use <a href="/products/stash/v0.9.0-rc.0/guides/latest/backends/gcs">GCS Backend</a> to store the backed up data. You can use any supported backend you prefer. You just have to configure Storage Secret and <code>spec.backend</code> section of <code>BackupBlueprint</code> to match your backend. To learn which backends are supported by Stash and how to configure them, please visit <a href="/products/stash/v0.9.0-rc.0/guides/latest/backends/overview">here</a>.</p>

<blockquote>
<p>For GCS backend, if the bucket does not exist, Stash needs <code>Storage Object Admin</code> role permissions to create the bucket. For more details, please check the following <a href="/products/stash/v0.9.0-rc.0/guides/latest/backends/gcs">guide</a>.</p>
</blockquote>

<p><strong>Create Storage Secret:</strong></p>

<p>At first, let&rsquo;s create a Storage Secret for the GCS backend,</p>

<pre><code class="language-console">$ echo -n 'changeit' &gt; RESTIC_PASSWORD
$ echo -n '&lt;your-project-id&gt;' &gt; GOOGLE_PROJECT_ID
$ mv downloaded-sa-json.key &gt; GOOGLE_SERVICE_ACCOUNT_JSON_KEY
$ kubectl create secret generic -n demo gcs-secret \
    --from-file=./RESTIC_PASSWORD \
    --from-file=./GOOGLE_PROJECT_ID \
    --from-file=./GOOGLE_SERVICE_ACCOUNT_JSON_KEY
secret/gcs-secret created
</code></pre>

<p><strong>Create BackupBlueprint:</strong></p>

<p>Now, we have to create a <code>BackupBlueprint</code> crd with a blueprint for <code>Repository</code> and <code>BackupConfiguration</code> object.</p>

<p>Below is the YAML of the <code>BackupBlueprint</code> object that we are going to create,</p>

<pre><code class="language-yaml">apiVersion: stash.appscode.com/v1beta1
kind: BackupBlueprint
metadata:
  name: workload-backup-blueprint
spec:
  # ============== Blueprint for Repository ==========================
  backend:
    gcs:
      bucket: appscode-qa
      prefix: stash-backup/${TARGET_NAMESPACE}/${TARGET_KIND}/${TARGET_NAME}
    storageSecretName: gcs-secret
  # ============== Blueprint for BackupConfiguration =================
  schedule: &quot;*/5 * * * *&quot;
  retentionPolicy:
    name: 'keep-last-5'
    keepLast: 5
    prune: true
</code></pre>

<p>Note that we have used some variables (format: <code>${&lt;variable name&gt;}</code>) in <code>backend.gcs.prefix</code> field. Stash will substitute these variables with values from the respective target. Since the resolved prefix will be different for different workload, the backed up data will be stored in different directory inside the bucket. To know which variable you can use in this <code>prefix</code> field, please visit <a href="/products/stash/v0.9.0-rc.0/concepts/crds/backupconfiguration_blueprint#repository-blueprint">here</a>.</p>

<p>Let&rsquo;s create the <code>BackupBlueprint</code> that we have shown above,</p>

<pre><code class="language-console">$ kubectl apply -f ./docs/examples/guides/latest/auto-backup/workload/backupblueprint.yaml
backupblueprint.stash.appscode.com/workload-backup-blueprint created
</code></pre>

<p>Now, automatic backup is configured for Kubernetes workloads (<code>Deployment</code>, <code>StatefulSet</code>, <code>DaemonSet</code> etc.). We just have to add some annotations to the targeted workload to enable periodic backup.</p>

<p><strong>Required Annotations for Workloads:</strong></p>

<p>You have to add the following 3 annotations to a targeted workload to enable backup for it:</p>

<ol>
<li><p>Name of the <code>BackupBlueprint</code> object where a blueprint for <code>Repository</code> and <code>BackupConfiguration</code> has been defined.</p>

<pre><code class="language-yaml">stash.appscode.com/backup-blueprint: &lt;BackupBlueprint name&gt;
</code></pre></li>

<li><p>List of paths that will be backed up. Use comma (<code>,</code>) to separate multiple file paths. For example, <code>&quot;/my/target/dir-1,/my/target/dir-2&quot;</code>.</p>

<pre><code class="language-yaml">stash.appscode.com/target-paths: &quot;&lt;paths to backup&gt;&quot;
</code></pre></li>

<li><p>List of Volumes and their MountPath where the target file paths are located. Use <code>&quot;&lt;volumenName&gt;:&lt;mountPath&gt;&quot;</code> format to specify the volumes. Use comma (<code>,</code>) to specify multiple volumes and mount path. For example, <code>&quot;vol-1:/mount/path-1,vol-2:/mount/path-2&quot;</code>.</p>

<pre><code class="language-yaml">stash.appscode.com/volume-mounts: &quot;&lt;volume&gt;:&lt;mountPath&gt;&quot;
</code></pre></li>
</ol>

<h2 id="backup-deployment">Backup Deployment</h2>

<p>Now, we are going to backup a Deployment using the blueprint we have configured earlier. We are going to mount two ConfigMap volume in two different directories of the Deployment. Then, we are going to backup those directories using automatic backup.</p>

<p><strong>Create Deployment:</strong></p>

<p>Below is the YAML of the Deployment and respective ConfigMaps that we are going to create,</p>

<pre><code class="language-yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: stash-sample-data-1
  namespace: demo
data:
  file1.txt: &quot;Data from ConfigMap 'stash-sample-data-1'&quot;
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: stash-sample-data-2
  namespace: demo
data:
  file2.txt: &quot;Data from ConfigMap 'stash-sample-data-2'&quot;
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: stash-demo
  name: stash-demo
  namespace: demo
  annotations:
    stash.appscode.com/backup-blueprint: workload-backup-blueprint
    stash.appscode.com/target-paths: &quot;/source/data-1,/source/data-2&quot;
    stash.appscode.com/volume-mounts: &quot;source-data-1:/source/data-1,source-data-2:/source/data-2&quot;
spec:
  replicas: 3
  selector:
    matchLabels:
      app: stash-demo
  template:
    metadata:
      labels:
        app: stash-demo
      name: busybox
    spec:
      containers:
      - args:
        - sleep
        - &quot;3600&quot;
        image: busybox
        imagePullPolicy: IfNotPresent
        name: busybox
        volumeMounts:
        - mountPath: /source/data-1
          name: source-data-1
        - mountPath: /source/data-2
          name: source-data-2
      restartPolicy: Always
      volumes:
      - name: source-data-1
        configMap:
          name: stash-sample-data-1
      - name: source-data-2
        configMap:
          name: stash-sample-data-2
</code></pre>

<p>Notice the <code>metadata.annotations</code> field. We have specified the automatic backup specific annotations to backup <code>/source/data-1</code> and <code>/source/data-2</code> directories of the <code>source-data-1</code> and <code>source-data-2</code> volumes respectively. We have also specified to use <code>workload-backup-blueprint</code> BackupBlueprint for creating <code>Repository</code> and <code>BackupConfiguration</code> for this Deployment. BackupBlueprint is a non-namespaced resource, so we just need to specify the name of the blueprint.</p>

<p>Let&rsquo;s create the above Deployment,</p>

<pre><code class="language-console">$ kubectl apply -f ./docs/examples/guides/latest/auto-backup/workload/deployment.yaml
configmap/stash-sample-data-1 created
configmap/stash-sample-data-2 created
deployment.apps/stash-demo created
</code></pre>

<p>If everything goes well, Stash will create a <code>Repository</code> and a <code>BackupConfiguration</code> with the name in the following format: <code>&lt;workload-kind&gt;-&lt;workload-name&gt;</code>.</p>

<p><strong>Verify Repository:</strong></p>

<p>Verify that the Repository has been created successfully by the following command,</p>

<pre><code class="language-console">$ kubectl get repository -n demo
NAME                    INTEGRITY   SIZE   SNAPSHOT-COUNT   LAST-SUCCESSFUL-BACKUP   AGE
deployment-stash-demo                                                                9s
</code></pre>

<p>If we view the YAML of this Repository, we are going to see that the variables <code>${TARGET_NAMESPACE}</code>, <code>${TARGET_KIND}</code> and <code>${TARGET_NAME}</code> has been replaced by <code>demo</code>, <code>deployment</code> and <code>stash-demo</code> respectively.</p>

<pre><code class="language-console">$ kubectl get repository -n demo deployment-stash-demo -o yaml
</code></pre>

<pre><code class="language-yaml">apiVersion: stash.appscode.com/v1beta1
kind: Repository
metadata:
  name: deployment-stash-demo
  namespace: demo
  ...
spec:
  backend:
    gcs:
      bucket: appscode-qa
      prefix: stash-backup/demo/deployment/stash-demo
    storageSecretName: gcs-secret
</code></pre>

<p><strong>Verify BackupConfiguratoin:</strong></p>

<p>Verify that the <code>BackupConfiguration</code> has been created by the following command,</p>

<pre><code class="language-console">$ kubectl get backupconfiguration -n demo
NAME                    TASK   SCHEDULE      PAUSED   AGE
deployment-stash-demo          */5 * * * *            19s
</code></pre>

<p>Let&rsquo;s check the YAML of this <code>BackupConfiguration</code>,</p>

<pre><code class="language-console">$ kubectl get backupconfiguration -n demo deployment-stash-demo -o yaml
</code></pre>

<pre><code class="language-yaml">apiVersion: stash.appscode.com/v1beta1
kind: BackupConfiguration
metadata:
  name: deployment-stash-demo
  namespace: demo
  ...
spec:
  repository:
    name: deployment-stash-demo
  retentionPolicy:
    keepLast: 5
    name: keep-last-5
    prune: true
  runtimeSettings: {}
  schedule: '*/5 * * * *'
  target:
    paths:
    - /source/data-1
    - /source/data-2
    ref:
      apiVersion: apps/v1
      kind: Deployment
      name: stash-demo
    volumeMounts:
    - mountPath: /source/data-1
      name: source-data-1
    - mountPath: /source/data-2
      name: source-data-2
  task: {}
  tempDir: {}
</code></pre>

<p>Notice that the <code>spec.target.ref</code> is pointing to the <code>stash-demo</code> Deployment. Also, notice that the <code>spec.target.paths</code> and <code>spec.target.volumeMounts</code> fields have been populated with the information we had provided as annotation of the Deployment.</p>

<p><strong>Wait for BackupSession:</strong></p>

<p>Now, wait for the next backup schedule. Run the following command to watch <code>BackupSession</code> crd:</p>

<pre><code class="language-console">$ watch -n 1 kubectl get backupsession -n demo -l=stash.appscode.com/backup-configuration=deployment-stash-demo

Every 1.0s: kubectl get backupsession -n demo                                   workstation: Wed Jun 26 12:20:31 2019
NAME                               BACKUPCONFIGURATION     PHASE       AGE
deployment-stash-demo-1561530008   deployment-stash-demo   Running     24s
deployment-stash-demo-1561530008   deployment-stash-demo   Succeeded   61s
</code></pre>

<blockquote>
<p>Note: Respective CronJob creates <code>BackupSession</code> crd with the following label <code>stash.appscode.com/backup-configuration=&lt;BackupConfiguration crd name&gt;</code>. We can use this label to watch only the <code>BackupSession</code> of our desired <code>BackupConfiguration</code>.</p>
</blockquote>

<p><strong>Verify Backup:</strong></p>

<p>When backup session is completed, Stash will update the respective <code>Repository</code> to reflect the latest state of backed up data.</p>

<p>Run the following command to check if the snapshots are stored in the backend,</p>

<pre><code class="language-console">$ kubectl get repository -n demo deployment-stash-demo
NAME                    INTEGRITY   SIZE    SNAPSHOT-COUNT   LAST-SUCCESSFUL-BACKUP   AGE
deployment-stash-demo   true        246 B   2                70s                      5m
</code></pre>

<blockquote>
<p>Stash creates one snapshot for each targeted file path. Since we are taking backup of two file paths, two snapshots have been created for this BackupSession.</p>
</blockquote>

<p>If we navigate to <code>stash-backup/demo/deployment/stash-demo</code> directory of our GCS bucket, we are going to see that the snapshot has been stored there.</p>

<figure align="center">
  <img alt="Backup data in GCS backend" src="/products/stash/v0.9.0-rc.0/images/guides/latest/auto-backup/workload/deployment_repo.png">
  <figcaption align="center">Fig: Backup data in GCS backend</figcaption>
</figure>

<blockquote>
<p>Stash keeps all backup data encrypted. So, snapshot files in the bucket will not contain any meaningful data until they are decrypted.</p>
</blockquote>

<h2 id="backup-statefulset">Backup StatefulSet</h2>

<p>Now, we are going to backup a StatefulSet with the same blueprint we have used to backup Deployment in the previous section.</p>

<p><strong>Create StatefulSet:</strong></p>

<p>We are going to create a StatefulSet with 3 replicas. We are going to configure the StatefulSet to generate sample data in each replica.</p>

<p>Below is the YAML of the StatefulSet that we are going to create,</p>

<pre><code class="language-yaml">apiVersion: v1
kind: Service
metadata:
  name: headless
  namespace: demo
spec:
  ports:
  - name: http
    port: 80
    targetPort: 0
  selector:
    app: stash-demo
  clusterIP: None
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: sts-demo
  namespace: demo
  labels:
    app: stash-demo
  annotations:
    stash.appscode.com/backup-blueprint: workload-backup-blueprint
    stash.appscode.com/target-paths: &quot;/source/data-1,/source/data-2&quot;
    stash.appscode.com/volume-mounts: &quot;source-data-1:/source/data-1,source-data-2:/source/data-2&quot;
spec:
  replicas: 3
  selector:
    matchLabels:
      app: stash-demo
  serviceName: headless
  template:
    metadata:
      labels:
        app: stash-demo
    spec:
      containers:
      - name: busybox
        image: busybox
        command: [&quot;/bin/sh&quot;, &quot;-c&quot;]
        args: [&quot;touch /source/data-1/sample-file-1.txt &amp;&amp; touch /source/data-2/sample-file-2.txt &amp;&amp; sleep 3000&quot;]
        imagePullPolicy: IfNotPresent
        volumeMounts:
        - mountPath: /source/data-1
          name: source-data-1
        - mountPath: /source/data-2
          name:  source-data-2
  volumeClaimTemplates:
  - metadata:
      name: source-data-1
    spec:
      accessModes: [ &quot;ReadWriteOnce&quot; ]
      storageClassName: &quot;standard&quot;
      resources:
        requests:
          storage: 1Gi
  - metadata:
      name: source-data-2
    spec:
      accessModes: [ &quot;ReadWriteOnce&quot; ]
      storageClassName: &quot;standard&quot;
      resources:
        requests:
          storage: 1Gi
</code></pre>

<p>Notice the <code>metadata.annotations</code> field. We have specified automatic backup specific annotations similarly as we had specified in the Deployment in the previous section.</p>

<p>Let&rsquo;s create the StatefulSet we have created above,</p>

<pre><code class="language-console">$ kubectl apply -f ./docs/examples/guides/latest/auto-backup/workload/statefulset.yaml
service/headless created
statefulset.apps/sts-demo created
</code></pre>

<p><strong>Verify Repository:</strong></p>

<p>Verify that a Repository has been created for this StatefulSet using the following command,</p>

<pre><code class="language-console">$ kubectl get repository -n demo
NAME                    INTEGRITY   SIZE    SNAPSHOT-COUNT   LAST-SUCCESSFUL-BACKUP   AGE
deployment-stash-demo   true        410 B   10               14s                      39m
statefulset-sts-demo                                                                  31s
</code></pre>

<p>Here, <code>statefulset-sts-demo</code> Repository has been created for our <code>sts-demo</code> StatefulSet.</p>

<p>Let&rsquo;s view the YAML of the Repository,</p>

<pre><code class="language-console">$ kubectl get repository -n demo statefulset-sts-demo -o yaml
</code></pre>

<pre><code class="language-yaml">apiVersion: stash.appscode.com/v1beta1
kind: Repository
metadata:
  name: statefulset-sts-demo
  namespace: demo
  ...
spec:
  backend:
    gcs:
      bucket: appscode-qa
      prefix: stash-backup/demo/statefulset/sts-demo
    storageSecretName: gcs-secret
</code></pre>

<p>Notice that the variables of the <code>prefix</code> field of <code>BackupBlueprint</code> is now replaced with <code>demo</code>, <code>statefulset</code> and <code>sts-demo</code> respectively.</p>

<p><strong>Verify BackupConfiguratoin:</strong></p>

<p>Verify that a <code>BackupConfiguration</code> has been created for this StatefulSet using the following command,</p>

<pre><code class="language-console">$ kubectl get backupconfiguration -n demo
NAME                    TASK   SCHEDULE      PAUSED   AGE
deployment-stash-demo          */5 * * * *            40m
statefulset-sts-demo           */5 * * * *            105s
</code></pre>

<p>Here, <code>statefulset-sts-demo</code> has been created for the StatefulSet <code>sts-demo</code>. You can check the YAML of this <code>BackupConfiguration</code> to see that the target field is pointing to this StatefulSet.</p>

<pre><code class="language-console">$ kubectl get backupconfiguration -n demo statefulset-sts-demo -o yaml
</code></pre>

<pre><code class="language-yaml">apiVersion: stash.appscode.com/v1beta1
kind: BackupConfiguration
metadata:
  name: statefulset-sts-demo
  namespace: demo
  ...
spec:
  repository:
    name: statefulset-sts-demo
  retentionPolicy:
    keepLast: 5
    name: keep-last-5
    prune: true
  runtimeSettings: {}
  schedule: '*/5 * * * *'
  target:
    paths:
    - /source/data-1
    - /source/data-2
    ref:
      apiVersion: apps/v1
      kind: StatefulSet
      name: sts-demo
    volumeMounts:
    - mountPath: /source/data-1
      name: source-data-1
    - mountPath: /source/data-2
      name: source-data-2
  task: {}
  tempDir: {}
</code></pre>

<p><strong>Wait for BackupSession:</strong></p>

<p>Now, wait for the next backup schedule. Watch the <code>BackupSession</code> of the BackupConfiguration <code>statefulset-sts-demo</code> using the following command,</p>

<pre><code class="language-console">$ watch -n 1 kubectl get backupsession -n demo -l=stash.appscode.com/backup-configuration=statefulset-sts-demo
Every 1.0s: kubectl get backupsession -n demo -l=stash.appscode.com/backup-...  workstation: Wed Jun 26 13:01:22 2019

NAME                              BACKUPCONFIGURATION    PHASE     AGE
statefulset-sts-demo-1561532403   statefulset-sts-demo   Running   79s
statefulset-sts-demo-1561532403   statefulset-sts-demo   Succeeded   2m21s
</code></pre>

<p><strong>Verify Backup:</strong></p>

<p>Once the backup session is completed, verify that the <code>Repository</code> has been updated to reflect the backup using the following command,</p>

<pre><code class="language-console">$ kubectl get repository -n demo statefulset-sts-demo
NAME                   INTEGRITY   SIZE   SNAPSHOT-COUNT   LAST-SUCCESSFUL-BACKUP   AGE
statefulset-sts-demo   true        0 B    6                32s                      7m29s
</code></pre>

<blockquote>
<p>For StatfulSet, Stash takes backup from every replica. Since we are using a StatefulSet with 3 replicas and we are taking backup of 2 file paths, total 6 snapshots have been created for this BackupSession.</p>
</blockquote>

<p>If we navigate to <code>stash-backup/demo/statefulset/sts-demo</code> directory of our GCS bucket, we are going to see that the snapshot been stored there.</p>

<figure align="center">
  <img alt="Backup data of `sts-demo` StatefulSet in GCS backend" src="/products/stash/v0.9.0-rc.0/images/guides/latest/auto-backup/workload/statefulset_repo.png">
  <figcaption align="center">Fig: Backup data of StatefulSet "sts-demo" in GCS backend</figcaption>
</figure>

<h2 id="backup-daemonset">Backup DaemonSet</h2>

<p>Now, we are going to use the same blueprint to backup a DaemonSet. We are going to mount a ConfigMap in <code>/etc/config</code> directory. Then, we are going to backup this directory using automatic backup.</p>

<p><strong>Create DaemonSet:</strong></p>

<p>Below is the YAML of the DaemonSet that we are going to create,</p>

<pre><code class="language-yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: my-daemon-config
  namespace: demo
data:
  config-file-1.txt: &quot;This is first config file&quot;
  config-file-2.txt: &quot;This is second config file&quot;
---
apiVersion: apps/v1
kind: DaemonSet
metadata:
  labels:
    app: stash-demo
  name: dmn-demo
  namespace: demo
  annotations:
    stash.appscode.com/backup-blueprint: workload-backup-blueprint
    stash.appscode.com/target-paths: &quot;/etc/config&quot;
    stash.appscode.com/volume-mounts: &quot;dmn-config:/etc/config&quot;
spec:
  selector:
    matchLabels:
      app: stash-demo
  template:
    metadata:
      labels:
        app: stash-demo
      name: busybox
    spec:
      containers:
      - name: busybox
        args:
        - sleep
        - &quot;3600&quot;
        image: busybox
        imagePullPolicy: IfNotPresent
        volumeMounts:
        - mountPath: /etc/config
          name: dmn-config
      restartPolicy: Always
      volumes:
      - name: dmn-config
        configMap:
          name: my-daemon-config
</code></pre>

<p>Notice the <code>metadata.annotations</code> field. We have specified automatic backup specific annotations to backup our desired file path.</p>

<p>Let&rsquo;s create the DaemonSet we have shown above,</p>

<pre><code class="language-console">$ kubectl apply -f ./docs/examples/guides/latest/auto-backup/workload/daemonset.yaml
configmap/my-daemon-config created
daemonset.apps/dmn-demo created
</code></pre>

<p><strong>Verify Repository:</strong></p>

<p>Verify that a <code>Repository</code> has been created for this DaemonSet using the following command,</p>

<pre><code class="language-console">$ kubectl get repository -n demo
NAME                    INTEGRITY   SIZE    SNAPSHOT-COUNT   LAST-SUCCESSFUL-BACKUP   AGE
daemonset-dmn-demo                                                                    28s
deployment-stash-demo   true        410 B   10               6m3s                     70m
statefulset-sts-demo    true        0 B     26               6m6s                     31m
</code></pre>

<p>Here, <code>daemonset-dmn-demo</code> Repository has been created for our <code>dmn-demo</code> DaemonSet.</p>

<p>Let&rsquo;s view the YAML of the Repository,</p>

<pre><code class="language-console">$ kubectl get repository -n demo daemonset-dmn-demo -o yaml
</code></pre>

<pre><code class="language-yaml">apiVersion: stash.appscode.com/v1beta1
kind: Repository
metadata:
  name: daemonset-dmn-demo
  namespace: demo
  ...
spec:
  backend:
    gcs:
      bucket: appscode-qa
      prefix: stash-backup/demo/daemonset/dmn-demo
    storageSecretName: gcs-secret
</code></pre>

<p><strong>Verify BackupConfiguratoin:</strong></p>

<p>Verify that a <code>BackupConfiguration</code> has been created for this DaemonSet using the following command,</p>

<pre><code class="language-console">$  kubectl get backupconfiguration -n demo
NAME                    TASK   SCHEDULE      PAUSED   AGE
daemonset-dmn-demo             */5 * * * *            90s
deployment-stash-demo          */5 * * * *            71m
statefulset-sts-demo           */5 * * * *            32m
</code></pre>

<p>Here, <code>daemonset-dmn-demo</code> has been created for the DaemonSet <code>dmn-demo</code>. You can check the YAML of this <code>BackupConfiguration</code> to see that the target field is pointing to this DaemonSet.</p>

<pre><code class="language-console">$ kubectl get backupconfiguration -n demo daemonset-dmn-demo -o yaml
</code></pre>

<pre><code class="language-yaml">apiVersion: stash.appscode.com/v1beta1
kind: BackupConfiguration
metadata:
  name: daemonset-dmn-demo
  namespace: demo
  ...
spec:
  repository:
    name: daemonset-dmn-demo
  retentionPolicy:
    keepLast: 5
    name: keep-last-5
    prune: true
  runtimeSettings: {}
  schedule: '*/5 * * * *'
  target:
    paths:
    - /etc/config
    ref:
      apiVersion: apps/v1
      kind: DaemonSet
      name: dmn-demo
    volumeMounts:
    - mountPath: /etc/config
      name: dmn-config
  task: {}
  tempDir: {}
</code></pre>

<p><strong>Wait for BackupSession:</strong></p>

<p>Now, wait for the next backup schedule. Watch the <code>BackupSession</code> of the BackupConfiguration <code>daemonset-dmn-demo</code> using the following command,</p>

<pre><code class="language-console">$ watch -n 1 kubectl get backupsession -n demo -l=stash.appscode.com/backup-configuration=daemonset-dmn-demo

Every 1.0s: kubectl get backupsession -n demo -l=stash.appscode.com/backup-...  workstation: Wed Jun 26 13:30:14 2019

NAME                            BACKUPCONFIGURATION   PHASE     AGE
daemonset-dmn-demo-1561534208   daemonset-dmn-demo    Running   6s
daemonset-dmn-demo-1561534208   daemonset-dmn-demo    Succeeded   45s
</code></pre>

<p><strong>Verify Backup:</strong></p>

<p>Once the backup session is completed, verify that the <code>Repository</code> has been updated to reflect the backup using the following command,</p>

<pre><code class="language-console">$ kubectl get repository -n demo daemonset-dmn-demo
NAME                 INTEGRITY   SIZE   SNAPSHOT-COUNT   LAST-SUCCESSFUL-BACKUP   AGE
daemonset-dmn-demo   true        51 B   1                5s                       4m27s
</code></pre>

<blockquote>
<p>For DaemonSet, Stash takes backup from every daemon pod running on different nodes. Since we are using a single node cluster (Minikube), only 1 snapshot has been created for this BackupSession.</p>
</blockquote>

<p>If we navigate to <code>stash-backup/demo/daemonset/dmn-demo</code> directory of our GCS bucket, we are going to see that the snapshot been stored there.</p>

<figure align="center">
  <img alt="Backup data of `dmn-demo` DaemonSet in GCS backend" src="/products/stash/v0.9.0-rc.0/images/guides/latest/auto-backup/workload/daemon_repo.png">
  <figcaption align="center">Fig: Backup data of DaemonSet "dmn-demo" in GCS backend</figcaption>
</figure>

<h2 id="cleanup">Cleanup</h2>

<p>To cleanup the Kubernetes resources created by this tutorial, run:</p>

<pre><code class="language-console">kubectl delete -n demo deployment/stash-demo
kubectl delete -n demo statefulset/sts-demo
kubectl delete -n demo daemonset/dmn-demo

kubectl delete -n demo repository --all
kubectl delete -n demo secret/gcs-secret
kubectl delete -n demo backupblueprint/workload-backup-blueprint
</code></pre>

<p>If you would like to uninstall Stash operator, please follow the steps <a href="/products/stash/v0.9.0-rc.0/setup/uninstall">here</a>.</p>

        </div>
      </div>
      <div class="column is-2">
        <div class="right-sidebar-area">
          
          <div class="search-area">
            <form action="#">
              <input id="acSearch" type="text" placeholder="Search..." />
              <button class="search-button">
                <i class="fa fa-search" aria-hidden="true"></i>
              </button>
            </form>
          </div>
          

          
          <div class="tbl-of-contents">
            <h4>What's on this Page</h4>
            <nav id="TableOfContents">
<ul>
<li><a href="#auto-backup-for-workloads">Auto Backup for Workloads</a>
<ul>
<li><a href="#before-you-begin">Before You Begin</a></li>
<li><a href="#prepare-backup-blueprint">Prepare Backup Blueprint</a></li>
<li><a href="#backup-deployment">Backup Deployment</a></li>
<li><a href="#backup-statefulset">Backup StatefulSet</a></li>
<li><a href="#backup-daemonset">Backup DaemonSet</a></li>
<li><a href="#cleanup">Cleanup</a></li>
</ul></li>
</ul>
</nav>
          </div>
          
        </div>
      </div>
    </div>
  </div>
  <script>
    
    var kdDropdown = document.querySelector(".dropdown");
    var kdDropdownBtn = document.querySelector(".dropdown-trigger");
      kdDropdownBtn.addEventListener("click", function(){
        kdDropdown.classList.toggle("is-active");
      })
  </script>
</div>





<div class="overlay-bg"></div>


<div class="sidebar-search-area">
  <div class="search-area-top">
    <h3>Search</h3>

    <div class="searchbar-area">
      <input type="search" name="search" id="searchbox" placeholder="Search..." />
      <button onclick="queryPage(1)"><i class="fa fa-search" aria-hidden="true"></i></button>
    </div>

    <span id="searchbar-script-container" style="display:none"></span>

    <div class="search-meta-information level">
      <div class="level-left">
      </div>
    </div>
  </div>

  <div class="search-result-wrapper">
  </div>

  
  <div class="pagination-area">
    <div class="pagination-list">
    </div>
  </div>
  
</div>

<script type="text/javascript">
  var pageSize = 5;
  var acSearch = document.querySelector("#acSearch");
  var bodyOverlay = document.querySelector(".overlay-bg");
  var sidebarSearch = document.querySelector(".sidebar-search-area");

  acSearch.addEventListener("click", function() {
    bodyOverlay.style.display = "block";
    sidebarSearch.style.right = "0";
    document.getElementById("searchbox").focus();
    bodyOverlay.addEventListener("click", function() {
      bodyOverlay.style.display = "none";
      sidebarSearch.style.right = "-50%";
    });
  });

  function encodeQueryData(data) {
    var ret = [];
    for (var d in data)
      ret.push(encodeURIComponent(d) + '=' + encodeURIComponent(data[d]));
    return ret.join('&');
  }

  document.querySelector(".searchbar-area input[type=search]").addEventListener("keyup", function(event) {
    event.preventDefault();
    if (event.keyCode === 13) {
      queryPage(1);
    }
  });

  function queryPage(idx) {
    var q = document.getElementById("searchbox").value;
    var cx = "015199383701854252104:jccvu4eiulw";
    var key = "AIzaSyBo15AW3hatf4fO8actJUZ_d5qZJpx0rXM";
    var imgSize = "small";
    var callback = "renderResult";

    var src = "https://www.googleapis.com/customsearch/v1?" + encodeQueryData({
      q: q,
      cx: cx,
      key: key,
      imgSize: imgSize,
      callback: callback,
      start: (idx-1)*pageSize + 1,
      num: pageSize,
    });

    var newScript = document.createElement("script");
    newScript.src = src;
    e = document.getElementById("searchbar-script-container");
    var child = e.lastElementChild;
    if (child) {
        e.removeChild(child);
    }
    e.appendChild(newScript);
  }

  function renderSearchResultEntry(e) {
    var out = '<div class="single-search-result">' +
      '<h3><a href="' + e.link + '">' + e.title + '</a></h3>' +
      '<a href="' + e.link + '">' + e.htmlFormattedUrl + '</a>' +
      '<div class="result-description-wrapper">';
      if (e.pagemap && e.pagemap.cse_thumbnail) {
        out += '<div class="result-thumb">' +
            '<img src="' + e.pagemap.cse_thumbnail[0].src + '" alt="" />' +
          '</div>';
      }
      out += '<div class="result-description">' +
          '<p>'+
            e.snippet +
          '</p>' +
        '</div>' +
      '</div>' +
    '</div>';
    return out;
  }

  function renderResult(response) {
    document.querySelector(".search-meta-information .level-left").innerHTML = '<div class="level-left">'+
        '<p>'+
          'About <span class="search-count">'+response.searchInformation.formattedTotalResults+'</span> results (<span class="time-count">'+response.searchInformation.formattedSearchTime+' </span>seconds)'+
        '</p>'+
      '</div>';

    if (!response.items) {
      return;
    }

    var searchResultWrapper = document.querySelector(".search-result-wrapper");
    searchResultWrapper.innerHTML = "";

    for (var i = 0; i < response.items.length; i++) {
      searchResultWrapper.innerHTML += renderSearchResultEntry(response.items[i]);
    }

    var pager = '<ul>';
    if (response.queries.previousPage) {
      var pageIndex = Math.floor(response.queries.previousPage[0].startIndex/pageSize) + 1;
      pager += '<li><a href="#" onclick="queryPage(' + pageIndex  + ')">Previous</a></li>';
    }
    if (response.queries.request) {
      var pageIndex = Math.floor(response.queries.request[0].startIndex/pageSize) + 1;
      pager += '<li><a href="#" onclick="queryPage(' + pageIndex  + ')" class="is-active">' + pageIndex + '</a></li>';
    }
    if (response.queries.nextPage) {
      var pageIndex = Math.floor(response.queries.nextPage[0].startIndex/pageSize) + 1;
      pager += '<li><a href="#" onclick="queryPage(' + pageIndex  + ')">Next</a></li>';
    }
    pager += '</ul>';
    document.querySelector(".pagination-area .pagination-list").innerHTML = pager;
  }
</script>





    
    
<section></section>

    

    
    
<section></section>

    

    
    
<section></section>

    

<button class="go-to-top" id="goTop">
  <i class="fa fa-angle-up" aria-hidden="true"></i>
</button>

    
    
    <footer class="footer-area">
      <div class="footer-top">
        <div class="container section">
          <div class="columns">
            <div class="column is-4">
              <div class="single-footer-widget">
                
                <div class="footer-logo">
                  <a href="https://appscode-v3-hugo.web.app"
                    ><img
                      src="/assets/images/logo-color-appscode.png"
                      alt=""
                      class="img"
                  /></a>
                </div>
                

                
                <div class="subscription-form">
                  <form action="https://appscode.us17.list-manage.com/subscribe/post?u=feb2bf31969a951e7449048a3&amp;id=82fb19acb9" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="navbar-form" target="_blank" novalidate role="email" role="email">
                    <label for="email">Subscribe to Our Newsletter</label>
                    <p class="spam-message">No spam, we promise. Your mail address is secure</p>
                    <div class="field has-addons">
                      <div class="control">
                        <input
                          class="input"
                          name="EMAIL"
                          id="mce-EMAIL"
                          type="email"
                          placeholder="Your work email address"
                          required
                        />
                        <button id="mc-embedded-subscribe" type="submit" name="subscribe" class="button">
                            <i class="fa fa-paper-plane-o" aria-hidden="true"></i>
                          </button>
                      </div>
                    </div>
                  </form>
                </div>
                

                
                <div class="contact-information">
                  <h4>Have any Inquiry?</h4>
                  <ul class="all-contact-info">
                    <li>
                      <a href="callto:+123456789"
                        ><span
                          ><i class="fa fa-phone" aria-hidden="true"></i></span
                        >+123 456 789</a
                      >
                    </li>

                    <li>
                      <a href="mailto:appscode@gmail.com"
                        ><span
                          ><i
                            class="fa fa-envelope-o"
                            aria-hidden="true"
                          ></i></span
                        >appscode@gmail.com</a
                      >
                    </li>
                  </ul>
                </div>
                
              </div>
            </div>

            <div class="column is-2">
              <div class="single-footer-widget">
                
                <div class="footer-menu">
                  <h4>Products</h4>
                  <ul class="footer-link">
                    <li><a href="#">Voyager</a></li>
                    <li><a href="#">KubeDB</a></li>
                    <li><a href="#">Stash</a></li>
                    <li><a href="#">Pharmer</a></li>
                    <li><a href="#">Service Broker</a></li>
                    <li><a href="#">Kubed</a></li>
                    <li><a href="#">Guard</a></li>
                    <li><a href="#">Swift</a></li>
                    <li><a href="#">Searchlight</a></li>
                  </ul>
                </div>
                
              </div>
            </div>

            <div class="column is-2">
              <div class="single-footer-widget">
                
                <div class="footer-menu">
                  <h4>Offerings</h4>
                  <ul class="footer-link">
                    <li><a href="#">Products</a></li>
                    <li><a href="#">Services</a></li>
                    <li><a href="#">Open source </a></li>
                  </ul>
                </div>
                
              </div>
            </div>

            <div class="column is-2">
              <div class="single-footer-widget">
                
                <div class="footer-menu">
                  <h4>Company</h4>
                  <ul class="footer-link">
                    <li><a href="/about/">About Us</a></li>
                    <li><a href="#">Blog</a></li>
                    <li><a href="#">Seles Inquiry</a></li>
                    <li><a href="#">Contact Us</a></li>
                  </ul>
                </div>
                
              </div>
            </div>

            <div class="column is-2">
              <div class="single-footer-widget">
                
                <div class="footer-menu">
                  <h4>Legal</h4>
                  <ul class="footer-link">
                    <li><a href="/legal/tos/">Terms of Sevice</a></li>
                    <li><a href="/legal/privacy-policy/">Privacy Policy</a></li>
                    <li><a href="/legal/security/">Security</a></li>
                    <li><a href="/legal/sla/">Service Level Agreement</a></li>
                  </ul>
                </div>
                
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="footer-bottom">
        <div class="container section">
          <div class="columns">
            <div class="column is-4">
              <p>All rights reserved © 2018. Appscode, Inc..</p>
            </div>
            <div class="column is-4 is-mobile has-text-centered">
              <div class="footer-inline-link">
                <a href="/legal/privacy-policy/">Privacy Policy</a>
                <a href="/legal/tos/">Terms of Service</a>
              </div>
            </div>
            <div class="column is-4 is-mobile has-text-right">
              <div class="socail-link-inline">
                <ul>
                  <li>
                    <a href="#"
                      ><i class="fa fa-twitter" aria-hidden="true"></i
                    ></a>
                  </li>
                  <li>
                    <a href="#"
                      ><i class="fa fa-facebook" aria-hidden="true"></i
                    ></a>
                  </li>
                  <li>
                    <a href="#"
                      ><i class="fa fa-github" aria-hidden="true"></i
                    ></a>
                  </li>
                  <li>
                    <a href="#"
                      ><i class="fa fa-youtube" aria-hidden="true"></i
                    ></a>
                  </li>
                  <li>
                    <a href="#"
                      ><i class="fa fa-twitter" aria-hidden="true"></i
                    ></a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </footer>
    
    

    
    <script src="/assets/js/bulma-carousel.min.js"></script>
    
    <script src="/assets/js/main.js"></script>
  </body>
</html>
